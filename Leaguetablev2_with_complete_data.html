<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store League Table Dashboard v2.0</title>
    <style>
        :root {
            --primary-color: #007AFF;
            --primary-dark: #0056b3;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --dark-text: #1d1d1f;
            --light-text: #666;
            --border-color: #e9ecef;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-hover: 0 6px 25px rgba(0,0,0,0.12);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            position: relative;
        }

        .header-content {
            flex: 1;
            text-align: center;
        }

        .header h1 {
            font-size: 3em;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-color), var(--info-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .incentive-image {
            max-width: 200px;
            max-height: 120px;
            width: auto;
            height: auto;
            margin-left: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: var(--transition);
        }

        .incentive-image:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .version-badge {
            display: none; /* Hidden - replaced with image */
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .subtitle {
            color: var(--light-text);
            font-size: 1.2em;
            font-weight: 400;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
            overflow: hidden;
        }

        .card:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        /* Upload Section */
        .upload-section {
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            display: none;
            border: 2px dashed transparent;
            transition: var(--transition);
        }

        .upload-section.show-admin {
            display: block;
        }

        .upload-section.drag-over {
            border-color: var(--primary-color);
            background: rgba(0, 122, 255, 0.05);
        }

        .file-input {
            margin: 25px 0;
            position: relative;
        }

        .file-input input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-label {
            display: block;
            padding: 20px;
            border: 3px dashed var(--border-color);
            border-radius: var(--border-radius);
            background: var(--light-bg);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .file-input-label:hover {
            border-color: var(--primary-color);
            background: rgba(0, 122, 255, 0.05);
        }

        .file-input-label i {
            font-size: 2em;
            color: var(--primary-color);
            display: block;
            margin-bottom: 10px;
        }

        /* Button Styles */
        .btn {
            display: inline-block;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            margin: 5px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transition: width 0.6s, height 0.6s, top 0.6s, left 0.6s;
            transform: translate(-50%, -50%);
        }

        .btn:hover::before {
            width: 200%;
            height: 200%;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, var(--success-color), #1e7e34);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, var(--danger-color), #bd2130);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, var(--warning-color), #e0a800);
            color: var(--dark-text);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--info-color));
        }

        .stat-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
            opacity: 0.1;
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .stat-value {
            font-size: 2.8em;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .stat-label {
            font-size: 1em;
            color: var(--light-text);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .content-section {
            padding: 25px;
        }

        .section-title {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--dark-text);
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: attr(data-icon);
            font-size: 1.2em;
        }

        /* Store Items */
        .store-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .store-item:hover {
            background: var(--light-bg);
            padding-left: 10px;
            border-radius: 8px;
        }

        .store-item:last-child {
            border-bottom: none;
        }

        .store-rank {
            font-weight: 800;
            font-size: 1.2em;
            color: var(--primary-color);
            min-width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 122, 255, 0.1);
            border-radius: 50%;
            margin-right: 15px;
        }

        .store-name {
            flex: 1;
            font-weight: 600;
            font-size: 1.1em;
        }

        .store-participation {
            font-size: 1em;
            color: var(--light-text);
            font-weight: 700;
            background: var(--light-bg);
            padding: 5px 12px;
            border-radius: 20px;
            margin-right: 10px;
        }

        .store-movement {
            font-size: 1.2em;
            font-weight: 800;
            min-width: 60px;
            text-align: center;
            padding: 5px 10px;
            border-radius: 20px;
        }

        /* Movement Colors */
        .movement-up {
            color: var(--success-color);
            background: rgba(40, 167, 69, 0.1);
        }

        .movement-down {
            color: var(--danger-color);
            background: rgba(220, 53, 69, 0.1);
        }

        .movement-new {
            color: var(--info-color);
            background: rgba(23, 162, 184, 0.1);
        }

        .movement-same {
            color: var(--light-text);
            background: var(--light-bg);
        }

        /* Table Styles */
        .table-section {
            padding: 25px;
            overflow-x: auto;
        }

        .league-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.95em;
        }

        .league-table th {
            background: linear-gradient(45deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .league-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .league-table tbody tr:hover {
            background: var(--light-bg);
            transform: scale(1.01);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .rank-cell {
            font-weight: 800;
            text-align: center;
            width: 80px;
            font-size: 1.1em;
            color: var(--primary-color);
        }

        .area-cell {
            text-align: center;
            font-weight: 600;
            width: 90px;
            font-size: 0.9em;
            color: var(--info-color);
        }

        .participation-cell {
            text-align: center;
            font-weight: 700;
            width: 120px;
        }

        .movement-cell {
            text-align: center;
            font-weight: 800;
            width: 100px;
        }

        /* Average Store and Below Average Highlighting */
        .average-store {
            background: linear-gradient(45deg, #fff3cd, #ffeaa7) !important;
            font-weight: 700;
            border-top: 3px solid var(--warning-color);
            border-bottom: 3px solid var(--warning-color);
        }

        .average-store:hover {
            background: linear-gradient(45deg, #fff3cd, #ffeaa7) !important;
            transform: scale(1.02) !important;
        }

        .below-north-west-average {
            background: rgba(255, 193, 7, 0.15) !important;
            border-left: 4px solid #ff9800;
        }

        .below-north-west-average:hover {
            background: rgba(255, 193, 7, 0.25) !important;
        }

        .below-north-average {
            background: rgba(255, 193, 203, 0.4) !important;
            border-left: 4px solid #e91e63;
        }

        .below-north-average:hover {
            background: rgba(255, 193, 203, 0.6) !important;
        }

        .below-north-west-average .rank-cell {
            background: #ff9800;
            color: white;
            border-radius: 50%;
            border: 3px solid #ff9800;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            font-size: 1em;
            font-weight: 800;
        }

        .below-north-average .rank-cell {
            background: #e91e63;
            color: white;
            border-radius: 50%;
            border: 3px solid #e91e63;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            font-size: 1em;
            font-weight: 800;
        }

        /* Average divider line */
        .average-divider {
            position: relative;
        }

        .average-divider::after {
            content: 'AVERAGE LINE';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--warning-color);
            color: #000;
            padding: 4px 10px;
            font-size: 0.7em;
            font-weight: 800;
            border-radius: 12px;
            text-shadow: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Admin Controls */
        .admin-controls {
            padding: 25px;
            text-align: center;
            display: none;
            border-top: 3px solid var(--warning-color);
            margin-bottom: 20px;
        }

        .admin-controls.show {
            display: block;
        }

        .admin-notice {
            background: linear-gradient(45deg, #d4edda, #c3e6cb);
            border: 1px solid var(--success-color);
            color: #155724;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
            text-align: center;
            font-weight: 600;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            margin: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Filter Section */
        .filter-section {
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--dark-text);
        }

        .filter-group select,
        .filter-group input {
            padding: 8px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            transition: var(--transition);
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* No Data State */
        .no-data {
            text-align: center;
            color: var(--light-text);
            font-style: italic;
            padding: 40px;
            font-size: 1.1em;
        }

        .no-data::before {
            content: '📊';
            font-size: 3em;
            display: block;
            margin-bottom: 15px;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .incentive-image {
                margin-left: 0;
                margin-top: 20px;
                max-width: 180px;
                max-height: 100px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .content-grid {
                gap: 15px;
            }
            
            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .store-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .store-rank {
                align-self: flex-start;
            }
        }

        /* Dark Mode Support - DISABLED for better visibility */
        /* @media (prefers-color-scheme: dark) {
            :root {
                --light-bg: #2c2c2e;
                --dark-text: #ffffff;
                --light-text: #8e8e93;
                --border-color: #3a3a3c;
            }
            
            body {
                background: linear-gradient(135deg, #1c1c1e 0%, #2c2c2e 100%);
            }
            
            .card {
                background: #1c1c1e;
                border: 1px solid var(--border-color);
            }
        } */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1>Store League Table Dashboard</h1>
                <p class="subtitle">Enhanced Performance Tracking & Analytics</p>
            </div>
            <img src="dewalt_incentive.png" alt="DeWalt Incentive" class="incentive-image">
        </div>

        <!-- Admin Upload Section -->
        <div id="uploadSection" class="card upload-section">
            <h2>📂 Upload CSV Data</h2>
            <p>Drag and drop your CSV file here or click to browse</p>
            <div class="file-input">
                <label class="file-input-label">
                    <i>📄</i>
                    <span>Choose CSV File</span>
                    <input type="file" id="csvFile" accept=".csv" />
                </label>
            </div>
            <button class="btn btn-primary" onclick="uploadFile()">
                📤 Upload & Process
            </button>
            
            <!-- URL Loading Section -->
            <div style="margin: 30px 0; padding: 20px; border-top: 2px dashed var(--border-color); border-radius: var(--border-radius);">
                <h3 style="margin-bottom: 15px; color: var(--primary-color);">🌐 Load from URL</h3>
                <p style="margin-bottom: 15px; color: var(--light-text);">Load JSON data directly from GitHub or any URL</p>
                
                <!-- Single URL Option -->
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; font-size: 1em; color: var(--dark-text);">📄 Single File (Current Data Only)</h4>
                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                        <input type="url" id="jsonUrl" placeholder="Enter GitHub raw JSON URL or leave empty for default" 
                               style="flex: 1; padding: 12px; border: 2px solid var(--border-color); border-radius: 6px; font-size: 14px;" />
                        <button class="btn btn-success" onclick="loadFromUrl()" style="white-space: nowrap;">
                            🔗 Load Single File
                        </button>
                    </div>
                    <small style="color: var(--light-text); font-style: italic;">
                        💡 Default: https://raw.githubusercontent.com/paulhilton74/Leaguetabledata/main/league.json
                    </small>
                </div>
                
                <!-- Two URL Option -->
                <div style="border-top: 1px solid var(--border-color); padding-top: 20px;">
                    <h4 style="margin-bottom: 10px; font-size: 1em; color: var(--dark-text);">📊 Two Files (with Movement Data)</h4>
                    <div style="margin-bottom: 10px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500; color: var(--dark-text);">Previous Day Data:</label>
                        <input type="url" id="previousDayUrl" placeholder="Enter previous day JSON URL" 
                               style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 6px; font-size: 14px;" />
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500; color: var(--dark-text);">Current Day Data:</label>
                        <input type="url" id="currentDayUrl" placeholder="Enter current day JSON URL or leave empty for default" 
                               style="width: 100%; padding: 12px; border: 2px solid var(--border-color); border-radius: 6px; font-size: 14px;" />
                    </div>
                    <button class="btn btn-primary" onclick="loadTwoFiles()" style="width: 100%;">
                        📈 Load Both Files & Calculate Movement
                    </button>
                    <small style="color: var(--light-text); font-style: italic; display: block; margin-top: 10px;">
                        🎯 This will calculate movement between the two days automatically
                    </small>
                </div>
            </div>
            
            <button class="btn btn-warning" onclick="toggleAdmin()">
                ⚙️ Admin Controls
            </button>
        </div>

        <!-- Admin Notice -->
        <div id="adminNotice" class="admin-notice" style="display: none;">
            🔧 <strong>Admin Mode Active</strong> - You have access to upload and management functions
        </div>

        <!-- Loading Section -->
        <div id="userSection" class="card upload-section" style="display: none;">
            <h2>🏆 League Table Dashboard</h2>
            <p>Loading latest store performance data...</p>
            <div class="loading"></div>
        </div>

        <!-- Admin Controls -->
        <div id="adminControls" class="card admin-controls">
            <h3>🛠️ Administrative Controls</h3>
            <div style="margin-top: 20px;">
                <button class="btn btn-danger" onclick="clearData()">
                    🗑️ Clear All Data
                </button>
                <button class="btn btn-success" onclick="exportData()">
                    📊 Export CSV
                </button>
                <button class="btn btn-primary" onclick="resetRankings()">
                    🔄 Reset Rankings
                </button>
                <button class="btn btn-warning" onclick="showDataInfo()">
                    ℹ️ Data Info
                </button>
                <button class="btn btn-primary" onclick="generateStandaloneVersion()">
                    📧 Generate Standalone Version
                </button>
                <button class="btn btn-success" onclick="exportJSON()">
                    📄 Export JSON Data
                </button>
                <button class="btn btn-primary" onclick="importJSON()">
                    📁 Import JSON Data
                </button>
                <button class="btn btn-warning" onclick="forceRefreshFromUrl()">
                    🔄 Force Refresh from URL
                </button>
                <button class="btn btn-info" onclick="quickRefresh()">
                    ⚡ Quick Refresh
                </button>
                <button class="btn btn-primary" onclick="loadEmbeddedData()">
                    📋 Load Embedded Data
                </button>
                <button class="btn btn-success" onclick="autoEmbedCurrentData()" style="background: linear-gradient(45deg, #28a745, #20c997); font-weight: bold;">
                    🔧 Auto-Embed Current Data
                </button>
                <button class="btn btn-info" onclick="showEmbedInstructions()" style="background: linear-gradient(45deg, #17a2b8, #138496);">
                    📝 Embed Instructions
                </button>
            </div>
        </div>

        <!-- Filter Section -->
        <div id="filterSection" class="filter-section" style="display: none;">
            <div class="filter-group">
                <label for="searchFilter">🔍 Search:</label>
                <input type="text" id="searchFilter" placeholder="Search stores..." onkeyup="filterStores()">
            </div>
            <div class="filter-group">
                <label for="areaFilter">🗺️ Area:</label>
                <select id="areaFilter" onchange="filterStores()">
                    <option value="">All Areas</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="sortBy">📈 Sort by:</label>
                <select id="sortBy" onchange="sortStores()">
                    <option value="rank">Rank</option>
                    <option value="participation">Participation</option>
                    <option value="name">Store Name</option>
                    <option value="movement">Movement</option>
                    <option value="area">Area</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="minParticipation">🎯 Min Participation:</label>
                <input type="number" id="minParticipation" placeholder="0" min="0" max="100" onchange="filterStores()">
            </div>
        </div>

        <!-- Main Dashboard -->
        <div id="dashboard" style="display: none;">
            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="card stat-card">
                    <div class="stat-icon">🏪</div>
                    <div class="stat-value" id="totalStores">0</div>
                    <div class="stat-label">Total Stores</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-icon">📊</div>
                    <div class="stat-value" id="avgParticipation">0%</div>
                    <div class="stat-label">Average Participation</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-icon">🏆</div>
                    <div class="stat-value" id="topStore" style="font-size: 1.8em; line-height: 1.2;">-</div>
                    <div class="stat-label">Top Performing Store</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-icon">📅</div>
                    <div class="stat-value" id="lastUpdated">-</div>
                    <div class="stat-label">Last Updated</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-icon">⭐</div>
                    <div class="stat-value" id="topPerformerCount">0</div>
                    <div class="stat-label">Above Average</div>
                </div>
            </div>

            <!-- Content Sections -->
            <div class="content-grid">
                <div class="card content-section">
                    <h3 class="section-title" data-icon="🥇">Top 5 Stores</h3>
                    <div id="topStores">
                        <div class="no-data">No data available</div>
                    </div>
                </div>

                <div class="card content-section">
                    <h3 class="section-title" data-icon="📉">Bottom 5 Stores</h3>
                    <div id="bottomStores">
                        <div class="no-data">No data available</div>
                    </div>
                </div>

                <div class="card content-section">
                    <h3 class="section-title" data-icon="🚀">Biggest Movers</h3>
                    <div id="biggestMovers">
                        <div class="no-data">No movement data available</div>
                    </div>
                </div>
            </div>

            <!-- Main League Table -->
            <div class="card table-section">
                <h3 class="section-title" data-icon="📋">Complete League Table</h3>
                <div style="overflow-x: auto;">
                    <table class="league-table" id="leagueTable">
                        <thead>
                            <tr>
                                <th class="rank-cell">Rank</th>
                                <th>Store Name</th>
                                <th class="area-cell">Area</th>
                                <th class="participation-cell">Participation %</th>
                                <th class="movement-cell">Movement</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <tr>
                                <td colspan="5" class="no-data">Upload CSV data to view league table</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let allStoreData = [];
        let previousData = [];
        let currentData = [];
        let filteredData = [];
        let isAdminUser = false;
        let uploadHistory = [];
        let availableAreas = [];

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Initializing League Table Dashboard v2.0...');
            checkAdminAccess();
            setupDragAndDrop();
            
            // Auto-load embedded data first
            if (window.EMBEDDED_LEAGUE_DATA && window.EMBEDDED_LEAGUE_DATA.stores) {
                console.log('🎯 Auto-loading embedded data...');
                loadEmbeddedData(false); // false = don't show alert popup
            } else {
                // Fallback to saved data or demo data
                loadSavedData().then(loaded => {
                    if (!loaded) {
                        console.log('📋 No saved data found, loading demo data...');
                        loadDemoData();
                    } else {
                        console.log('✅ Saved data loaded successfully');
                    }
                }).catch(error => {
                    console.error('Error during initialization:', error);
                    console.log('📋 Loading demo data as fallback...');
                    loadDemoData();
                });
            }
        });

        // Admin Access Control
        function checkAdminAccess() {
            const urlParams = new URLSearchParams(window.location.search);
            isAdminUser = urlParams.get('admin') === '1';
            
            console.log('🔧 Admin mode detected:', isAdminUser);
            
            if (isAdminUser) {
                document.getElementById('uploadSection').classList.add('show-admin');
                document.getElementById('adminNotice').style.display = 'block';
                console.log('✅ Admin controls enabled');
            } else {
                document.getElementById('userSection').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('userSection').style.display = 'none';
                }, 1000);
            }
        }

        // Drag and Drop Setup
        function setupDragAndDrop() {
            const uploadSection = document.getElementById('uploadSection');
            const fileInput = document.getElementById('csvFile');

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadSection.addEventListener(eventName, preventDefaults);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                uploadSection.addEventListener(eventName, () => uploadSection.classList.add('drag-over'));
            });

            ['dragleave', 'drop'].forEach(eventName => {
                uploadSection.addEventListener(eventName, () => uploadSection.classList.remove('drag-over'));
            });

            uploadSection.addEventListener('drop', handleDrop);

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            function handleDrop(e) {
                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].name.endsWith('.csv')) {
                    fileInput.files = files;
                    processFile(files[0]);
                }
            }
        }

        // Data Loading Functions
        async function loadSavedData() {
            try {
                const savedData = localStorage.getItem('leagueTableDataV2');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    allStoreData = data.allStoreData || [];
                    previousData = data.previousData || [];
                    uploadHistory = data.uploadHistory || [];
                    
                    if (allStoreData.length > 0) {
                        processData();
                        return true;
                    }
                }
            } catch (error) {
                console.error('Error loading saved data:', error);
            }
            return false;
        }

        function loadDemoData() {
            console.log('📋 Loading demo data...');
            const demoData = [
                { store: 'A031 DOUGLAS - ISLE OF MAN', participation: 16.7 },
                { store: 'A025 TELFORD - STAFFORD PARK', participation: 10.3 },
                { store: 'A031 ASTON', participation: 9.7 },
                { store: 'A025 BIRKENHEAD', participation: 9.7 },
                { store: 'A031 KIRKBY', participation: 9.3 },
                { store: 'A025 GLOSSOP', participation: 9.3 },
                { store: 'A031 WOLVERHAMPTON - MARSTRAND', participation: 7.2 },
                { store: 'A025 CHESTER', participation: 6.8 },
                { store: 'A031 STOKE - BURSLEM', participation: 5.9 },
                { store: 'A025 WALSALL WOOD', participation: 5.2 },
                { store: 'A031 BOLTON', participation: 4.8 },
                { store: 'A025 CARNFORTH', participation: 4.1 },
                { store: 'A031 WEDNESBURY', participation: 3.9 },
                { store: 'A025 MACCLESFIELD', participation: 3.7 }
            ];

            console.log('📋 Demo data prepared:', demoData.length, 'stores');
            
            allStoreData = demoData;
            uploadHistory.push({
                fileName: 'Demo Data (Location/Participation %)',
                uploadTime: new Date().toLocaleString(),
                recordCount: demoData.length
            });
            
            console.log('🔄 Processing demo data...');
            processData();
            saveDataToStorage();
            console.log('✅ Demo data loaded and processed successfully');
        }

        function saveDataToStorage() {
            const dataToSave = {
                allStoreData,
                previousData,
                uploadHistory,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('leagueTableDataV2', JSON.stringify(dataToSave));
        }

        // URL Loading Functions
        async function loadFromUrl() {
            const urlInput = document.getElementById('jsonUrl');
            let url = urlInput.value.trim();
            
            // If no URL provided, use the default GitHub URL
            if (!url) {
                url = 'https://raw.githubusercontent.com/paulhilton74/Leaguetabledata/main/league.json';
                urlInput.value = url;
            }
            
            console.log('🌐 Loading data from URL:', url);
            
            try {
                // Show loading indicator
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '⏳ Loading...';
                button.disabled = true;
                
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const jsonData = await response.json();
                console.log('📊 JSON data received:', jsonData);
                
                // Process the JSON data - handle the expected format
                if (jsonData.stores && Array.isArray(jsonData.stores)) {
                    console.log('✅ Processing stores data...');
                    
                    // Store previous data for movement calculation
                    previousData = [...allStoreData];
                    
                    // Convert JSON format to internal format and preserve movement data
                    allStoreData = jsonData.stores.map(store => {
                        // Handle movement data that might be embedded
                        let movement = 'NEW';
                        if (store.movement !== undefined && store.movement !== null) {
                            if (typeof store.movement === 'string') {
                                // Handle string format like "+5", "-3", "0", "NEW"
                                if (store.movement === '0' || store.movement === 0) {
                                    movement = 0;
                                } else if (store.movement.startsWith('+')) {
                                    movement = parseInt(store.movement.substring(1));
                                } else if (store.movement.startsWith('-')) {
                                    movement = -parseInt(store.movement.substring(1));
                                } else if (!isNaN(parseInt(store.movement))) {
                                    movement = parseInt(store.movement);
                                }
                            } else if (typeof store.movement === 'number') {
                                movement = store.movement;
                            }
                        } else if (store.previousRank && store.rank) {
                            // Calculate movement from ranks if not provided
                            movement = store.previousRank - store.rank;
                        }
                        
                        return {
                            store: store.store,
                            participation: store.participation || 0,
                            rank: store.rank || 0,
                            movement: movement,
                            previousRank: store.previousRank || null,
                            area: store.area ? store.area.display : 'Unknown'
                        };
                    });
                    
                    // Add to upload history
                    uploadHistory.push({
                        fileName: `URL: ${new URL(url).hostname}`,
                        uploadTime: new Date().toLocaleString(),
                        recordCount: allStoreData.length,
                        source: 'URL'
                    });
                    
                    console.log('🔄 Processing data...');
                    processData();
                    saveDataToStorage();
                    
                    // Reset button
                    button.innerHTML = originalText;
                    button.disabled = false;
                    
                    // Calculate movement statistics
                    const movedUp = allStoreData.filter(s => typeof s.movement === 'number' && s.movement > 0).length;
                    const movedDown = allStoreData.filter(s => typeof s.movement === 'number' && s.movement < 0).length;
                    const stayedSame = allStoreData.filter(s => s.movement === 0).length;
                    const newStores = allStoreData.filter(s => s.movement === 'NEW').length;
                    
                    alert(`✅ Data loaded successfully from URL!\n\n` +
                          `📊 Stores loaded: ${allStoreData.length}\n` +
                          `📊 Source: ${jsonData.metadata ? jsonData.metadata.dataSource : 'Unknown'}\n` +
                          `📊 Average: ${jsonData.metadata ? jsonData.metadata.averageParticipation + '%' : 'Unknown'}\n\n` +
                          `📈 Movement Summary:\n` +
                          `🔺 Moved Up: ${movedUp}\n` +
                          `🔻 Moved Down: ${movedDown}\n` +
                          `➖ Stayed Same: ${stayedSame}\n` +
                          `🆕 New Stores: ${newStores}`);
                    
                } else {
                    throw new Error('Invalid JSON format. Expected data with stores array.');
                }
                
            } catch (error) {
                console.error('❌ Error loading data from URL:', error);
                
                // Reset button
                const button = event.target;
                button.innerHTML = '🔗 Load from URL';
                button.disabled = false;
                
                alert(`❌ Error loading data from URL:\n\n${error.message}\n\nPlease check:\n• URL is accessible\n• JSON format is correct\n• Internet connection`);
            }
        }

        // Two Files Loading Function
        async function loadTwoFiles() {
            const previousDayUrlInput = document.getElementById('previousDayUrl');
            const currentDayUrlInput = document.getElementById('currentDayUrl');
            
            let previousDayUrl = previousDayUrlInput.value.trim();
            let currentDayUrl = currentDayUrlInput.value.trim();
            
            // Validate URLs
            if (!previousDayUrl) {
                alert('❌ Please enter the Previous Day URL');
                return;
            }
            
            // If no current day URL provided, use the default GitHub URL
            if (!currentDayUrl) {
                currentDayUrl = 'https://raw.githubusercontent.com/paulhilton74/Leaguetabledata/main/league.json';
                currentDayUrlInput.value = currentDayUrl;
            }
            
            console.log('📊 Loading data from two URLs:');
            console.log('📅 Previous day:', previousDayUrl);
            console.log('📅 Current day:', currentDayUrl);
            
            try {
                // Show loading indicator
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '⏳ Loading Previous Day...';
                button.disabled = true;
                
                // Load previous day data
                const previousResponse = await fetch(previousDayUrl);
                if (!previousResponse.ok) {
                    throw new Error(`Previous day data: HTTP error! status: ${previousResponse.status}`);
                }
                const previousDayData = await previousResponse.json();
                
                button.innerHTML = '⏳ Loading Current Day...';
                
                // Load current day data
                const currentResponse = await fetch(currentDayUrl);
                if (!currentResponse.ok) {
                    throw new Error(`Current day data: HTTP error! status: ${currentResponse.status}`);
                }
                const currentDayData = await currentResponse.json();
                
                button.innerHTML = '⏳ Calculating Movement...';
                
                // Validate data format
                if (!previousDayData.stores || !Array.isArray(previousDayData.stores)) {
                    throw new Error('Previous day data: Invalid JSON format. Expected stores array.');
                }
                if (!currentDayData.stores || !Array.isArray(currentDayData.stores)) {
                    throw new Error('Current day data: Invalid JSON format. Expected stores array.');
                }
                
                console.log('✅ Both datasets loaded successfully');
                console.log('📊 Previous day stores:', previousDayData.stores.length);
                console.log('📊 Current day stores:', currentDayData.stores.length);
                
                // Create a map of previous day rankings for quick lookup
                const previousRankings = new Map();
                previousDayData.stores.forEach(store => {
                    previousRankings.set(store.store, store.rank);
                });
                
                // Process current day data and calculate movement
                previousData = previousDayData.stores.map(store => ({
                    store: store.store,
                    participation: store.participation || 0,
                    rank: store.rank || 0,
                    area: store.area ? store.area.display : 'Unknown'
                }));
                
                allStoreData = currentDayData.stores.map(store => {
                    const previousRank = previousRankings.get(store.store);
                    let movement = 'NEW';
                    
                    if (previousRank !== undefined) {
                        movement = previousRank - (store.rank || 0);
                        if (movement === 0) {
                            movement = 0; // No change
                        }
                    }
                    
                    return {
                        store: store.store,
                        participation: store.participation || 0,
                        rank: store.rank || 0,
                        movement: movement,
                        previousRank: previousRank || null,
                        area: store.area ? store.area.display : 'Unknown'
                    };
                });
                
                // Add to upload history
                uploadHistory.push({
                    fileName: `Two-Day Comparison: ${new URL(previousDayUrl).hostname} vs ${new URL(currentDayUrl).hostname}`,
                    uploadTime: new Date().toLocaleString(),
                    recordCount: allStoreData.length,
                    source: 'Two URLs'
                });
                
                console.log('🔄 Processing data with movement calculations...');
                processData();
                saveDataToStorage();
                
                // Reset button
                button.innerHTML = originalText;
                button.disabled = false;
                
                // Calculate movement statistics
                const movedUp = allStoreData.filter(s => typeof s.movement === 'number' && s.movement > 0).length;
                const movedDown = allStoreData.filter(s => typeof s.movement === 'number' && s.movement < 0).length;
                const stayedSame = allStoreData.filter(s => s.movement === 0).length;
                const newStores = allStoreData.filter(s => s.movement === 'NEW').length;
                
                alert(`✅ Two-day comparison loaded successfully!\n\n` +
                      `📊 Total Stores: ${allStoreData.length}\n` +
                      `🔺 Moved Up: ${movedUp}\n` +
                      `🔻 Moved Down: ${movedDown}\n` +
                      `➖ Stayed Same: ${stayedSame}\n` +
                      `🆕 New Stores: ${newStores}\n\n` +
                      `Movement data calculated automatically!`);
                
            } catch (error) {
                console.error('❌ Error loading two-day data:', error);
                
                // Reset button
                const button = event.target;
                button.innerHTML = '📈 Load Both Files & Calculate Movement';
                button.disabled = false;
                
                alert(`❌ Error loading two-day comparison:\n\n${error.message}\n\nPlease check:\n• Both URLs are accessible\n• JSON formats are correct\n• Internet connection`);
            }
        }

        // Force Refresh Function with enhanced debugging
        async function forceRefreshFromUrl() {
            console.log('🔄 Force refresh initiated...');
            
            // Additional confirmation
            if (!confirm('🔄 This will clear all local data and force download fresh data from GitHub.\n\nAre you sure you want to continue?')) {
                return;
            }
            
            try {
                // Clear all local data first
                console.log('🗬 Clearing localStorage...');
                localStorage.removeItem('leagueTableDataV2');
                allStoreData = [];
                previousData = [];
                currentData = [];
                uploadHistory = [];
                
                // Hide dashboard during refresh
                document.getElementById('dashboard').style.display = 'none';
                
                // Show loading indicator
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '⏳ Force Refreshing...';
                button.disabled = true;
                
                // Build URL with cache-busting parameter
                const baseUrl = 'https://raw.githubusercontent.com/paulhilton74/Leaguetabledata/main/league.json';
                const cacheBuster = new Date().getTime();
                const url = `${baseUrl}?t=${cacheBuster}&nocache=true`;
                
                console.log('🌐 Force loading from URL:', url);
                
                // Force fetch with no-cache headers
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const jsonData = await response.json();
                console.log('📊 Fresh JSON data received:', jsonData.metadata);
                
                // Process the JSON data with movement handling
                if (jsonData.stores && Array.isArray(jsonData.stores)) {
                    console.log('✅ Processing fresh stores data...');
                    
                    // Convert JSON format to internal format and preserve movement data
                    allStoreData = jsonData.stores.map(store => {
                        // Handle movement data that might be embedded
                        let movement = 'NEW';
                        if (store.movement !== undefined && store.movement !== null) {
                            if (typeof store.movement === 'string') {
                                // Handle string format like "+5", "-3", "0", "NEW"
                                if (store.movement === '0' || store.movement === 0) {
                                    movement = 0;
                                } else if (store.movement.startsWith('+')) {
                                    movement = parseInt(store.movement.substring(1));
                                } else if (store.movement.startsWith('-')) {
                                    movement = -parseInt(store.movement.substring(1));
                                } else if (!isNaN(parseInt(store.movement))) {
                                    movement = parseInt(store.movement);
                                }
                            } else if (typeof store.movement === 'number') {
                                movement = store.movement;
                            }
                        } else if (store.previousRank && store.rank) {
                            // Calculate movement from ranks if not provided
                            movement = store.previousRank - store.rank;
                        }
                        
                        return {
                            store: store.store,
                            participation: store.participation || 0,
                            rank: store.rank || 0,
                            movement: movement,
                            previousRank: store.previousRank || null,
                            area: store.area ? store.area.display : 'Unknown'
                        };
                    });
                    
                    // Add to upload history with force refresh indicator
                    uploadHistory.push({
                        fileName: `Force Refresh: GitHub (${new Date().toLocaleTimeString()})`,
                        uploadTime: new Date().toLocaleString(),
                        recordCount: allStoreData.length,
                        source: 'Force Refresh'
                    });
                    
                    console.log('🔄 Processing fresh data...');
                    processData();
                    saveDataToStorage();
                    
                    // Reset button
                    button.innerHTML = originalText;
                    button.disabled = false;
                    
                    // Calculate movement statistics
                    const movedUp = allStoreData.filter(s => typeof s.movement === 'number' && s.movement > 0).length;
                    const movedDown = allStoreData.filter(s => typeof s.movement === 'number' && s.movement < 0).length;
                    const stayedSame = allStoreData.filter(s => s.movement === 0).length;
                    const newStores = allStoreData.filter(s => s.movement === 'NEW').length;
                    
                    alert(`✅ Force refresh successful!\n\n` +
                          `📊 Fresh data loaded: ${allStoreData.length} stores\n` +
                          `📊 Source: ${jsonData.metadata ? jsonData.metadata.dataSource : 'Unknown'}\n` +
                          `📊 Export Time: ${jsonData.metadata ? jsonData.metadata.exportTime : 'Unknown'}\n` +
                          `📊 Average: ${jsonData.metadata ? jsonData.metadata.averageParticipation + '%' : 'Unknown'}\n\n` +
                          `📈 Movement Summary:\n` +
                          `🔺 Moved Up: ${movedUp}\n` +
                          `🔻 Moved Down: ${movedDown}\n` +
                          `➖ Stayed Same: ${stayedSame}\n` +
                          `🆕 New Stores: ${newStores}\n\n` +
                          `🚀 Cache cleared & fresh data loaded!`);
                    
                } else {
                    throw new Error('Invalid JSON format. Expected data with stores array.');
                }
                
            } catch (error) {
                console.error('❌ Error during force refresh:', error);
                
                // Reset button
                const button = event.target;
                button.innerHTML = '🔄 Force Refresh from URL';
                button.disabled = false;
                
                alert(`❌ Force refresh failed:\n\n${error.message}\n\nPlease check:\n• Internet connection\n• GitHub repository is accessible\n• JSON format is correct`);
            }
        }

        // Quick Refresh - simpler method
        function quickRefresh() {
            console.log('⚡ Quick refresh initiated...');
            
            try {
                // Clear localStorage and reset variables
                localStorage.clear();
                allStoreData = [];
                previousData = [];
                currentData = [];
                uploadHistory = [];
                
                // Hide dashboard
                document.getElementById('dashboard').style.display = 'none';
                
                // Build cache-busted URL
                const timestamp = new Date().getTime();
                const url = `https://raw.githubusercontent.com/paulhilton74/Leaguetabledata/main/league.json?nocache=${timestamp}`;
                
                // Update the URL input field
                document.getElementById('jsonUrl').value = url;
                
                // Show user what's happening
                alert(`⚡ Quick refresh started!\n\nURL: ${url}\n\nClick OK, then click 'Load Single File' to complete the refresh.`);
                
            } catch (error) {
                console.error('❌ Quick refresh error:', error);
                alert(`❌ Quick refresh failed: ${error.message}`);
            }
        }

        // File Processing
        function uploadFile() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a CSV file first.');
                return;
            }
            
            processFile(file);
        }

        function processFile(file) {
            if (!file.name.toLowerCase().endsWith('.csv')) {
                alert('Please select a valid CSV file.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    processCSV(e.target.result, file.name);
                } catch (error) {
                    alert('Error processing CSV file: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function processCSV(csvContent, fileName) {
            // Remove BOM if present and handle different line endings
            csvContent = csvContent.replace(/^\uFEFF/, '').replace(/\r\n/g, '\n').replace(/\r/g, '\n');
            
            const lines = csvContent.trim().split('\n');
            if (lines.length < 2) {
                alert('CSV file must contain at least a header and one data row.');
                return;
            }

            // Enhanced CSV parsing to handle quoted values with commas
            function parseCSVLine(line) {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                result.push(current.trim());
                return result;
            }

            // Parse headers
            const rawHeaders = parseCSVLine(lines[0]);
            const headers = rawHeaders.map(h => h.trim());
            const normalized = headers.map(h => h.replace(/\s+/g, '').toLowerCase());

            console.log('Detected headers:', rawHeaders);

            // Accept common variants for store/location and participation columns
            const storeIndex = normalized.findIndex(h =>
                ['store', 'storename', 'shop', 'branch', 'location', 'sitename', 'outlet']
                    .some(key => h.includes(key))
            );
            const participationIndex = normalized.findIndex(h =>
                ['participation%', 'participation', 'participationpercent', 'participationpercentage', 'percent', 'percentage']
                    .some(key => h.includes(key))
            );
            const areaCodeIndex = normalized.findIndex(h =>
                h === 'areacode' || h.includes('areacode')
            );

            console.log('Store column index:', storeIndex, 'Participation column index:', participationIndex, 'Area code index:', areaCodeIndex);

            if (storeIndex === -1 || participationIndex === -1) {
                alert(
                    'CSV must contain "Store/Location" and "Participation %" columns.\n' +
                    'Detected headers: ' + rawHeaders.join(', ')
                );
                return;
            }

            // Store previous data for movement calculation
            previousData = [...allStoreData];

            // Process new data
            const newData = [];
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue; // Skip empty lines
                
                const values = parseCSVLine(lines[i]);
                
                const maxIndex = Math.max(storeIndex, participationIndex, areaCodeIndex !== -1 ? areaCodeIndex : 0);
                if (values.length > maxIndex) {
                    const store = values[storeIndex]?.trim();
                    let participationRaw = values[participationIndex]?.trim();
                    const areaCode = areaCodeIndex !== -1 ? values[areaCodeIndex]?.trim() : null;
                    
                    if (store && participationRaw) {
                        // Clean up participation value - remove %, handle decimals properly
                        participationRaw = participationRaw.replace('%', '').replace(/,/g, '');
                        const participation = parseFloat(participationRaw);
                        
                        console.log(`Processing: ${store} -> ${participationRaw} -> ${participation}% -> Area: ${areaCode}`);
                        
                        if (!isNaN(participation) && participation >= 0 && participation <= 100) {
                            const storeData = { store, participation };
                            if (areaCode) {
                                storeData.areaCode = areaCode;
                            }
                            newData.push(storeData);
                        } else if (!isNaN(participation)) {
                            console.warn(`Suspicious participation value for ${store}: ${participation}%`);
                            const storeData = { store, participation };
                            if (areaCode) {
                                storeData.areaCode = areaCode;
                            }
                            newData.push(storeData);
                        }
                    }
                }
            }

            console.log('Processed data:', newData);

            if (newData.length === 0) {
                alert('No valid data found in CSV file.');
                return;
            }

            allStoreData = newData;
            
            // Update upload history
            uploadHistory.push({
                fileName: fileName || 'Unknown File',
                uploadTime: new Date().toLocaleString(),
                recordCount: newData.length
            });

            processData();
            saveDataToStorage();
            
            // Show success message
            setTimeout(() => {
                alert(`Successfully processed ${newData.length} store records!`);
            }, 100);
        }

        // Data Processing
        function processData() {
            if (allStoreData.length === 0) return;

            // Calculate rankings and movements
            currentData = allStoreData.map(store => {
                const previousStore = previousData.find(p => p.store === store.store);
                const previousRank = previousStore 
                    ? previousData
                        .sort((a, b) => b.participation - a.participation)
                        .findIndex(p => p.store === store.store) + 1 
                    : null;
                
                // Use existing area data if available (from embedded JSON), otherwise extract from name
                const area = store.area && store.area.display ? store.area : extractAreaInfo(store);
                
                return { ...store, previousRank, area };
            });

            // Sort by participation (descending)
            currentData.sort((a, b) => b.participation - a.participation);

            // Add current rank and movement
            currentData.forEach((store, index) => {
                store.rank = index + 1;
                // Use existing movement data if available (from embedded JSON), otherwise calculate
                if (store.movement === undefined || store.movement === null) {
                    store.movement = calculateMovement(store.previousRank, store.rank);
                }
            });

            filteredData = [...currentData];
            updateAreaDropdown();
            updateDashboard();
        }

        function extractAreaInfo(store) {
            // First, try to use the areaCode field from CSV if available
            if (store.areaCode && store.areaCode.trim() && store.areaCode !== '') {
                const areaCode = store.areaCode.trim().toUpperCase();
                const areaMatch = areaCode.match(/A(\d+)/i);
                if (areaMatch) {
                    const areaNumber = parseInt(areaMatch[1]);
                    return {
                        code: areaCode,
                        number: areaNumber,
                        display: `Area ${areaNumber}`
                    };
                }
            }
            
            // Fallback: Extract area code from store name (e.g., "A031" from store name)
            const areaMatch = store.store.match(/A(\d{3})/i);
            if (areaMatch) {
                const areaNumber = parseInt(areaMatch[1]);
                return {
                    code: areaMatch[0].toUpperCase(),
                    number: areaNumber,
                    display: `Area ${areaNumber}`
                };
            }
            
            // If no area code found, try to extract from other patterns
            // Look for patterns like "Area 31", "AREA31", etc.
            const areaPattern = store.store.match(/area\s*(\d+)/i);
            if (areaPattern) {
                const areaNumber = parseInt(areaPattern[1]);
                return {
                    code: `A${areaNumber.toString().padStart(3, '0')}`,
                    number: areaNumber,
                    display: `Area ${areaNumber}`
                };
            }
            
            return {
                code: 'UNKNOWN',
                number: 0,
                display: 'No Area'
            };
        }

        function updateAreaDropdown() {
            // Extract unique areas from current data
            const areas = [...new Set(currentData.map(store => store.area.code))]
                .filter(code => code !== 'UNKNOWN')
                .sort((a, b) => {
                    const numA = parseInt(a.substring(1));
                    const numB = parseInt(b.substring(1));
                    return numA - numB;
                });
            
            availableAreas = areas;
            
            const areaSelect = document.getElementById('areaFilter');
            // Clear existing options except "All Areas"
            while (areaSelect.children.length > 1) {
                areaSelect.removeChild(areaSelect.lastChild);
            }
            
            // Add area options
            areas.forEach(areaCode => {
                const option = document.createElement('option');
                option.value = areaCode;
                const areaNumber = parseInt(areaCode.substring(1));
                option.textContent = `Area ${areaNumber} (${areaCode})`;
                areaSelect.appendChild(option);
            });
        }

        function calculateMovement(previousRank, currentRank) {
            if (!previousRank) return 'NEW';
            const change = previousRank - currentRank;
            return change;
        }

        // Dashboard Updates
        function updateDashboard() {
            console.log('📏 Updating dashboard with', currentData.length, 'stores');
            if (currentData.length === 0) {
                console.warn('⚠️ No current data available for dashboard update');
                return;
            }

            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('filterSection').style.display = 'flex';
            console.log('✅ Dashboard made visible');
            
            updateStatistics();
            updateTopBottomStores();
            updateBiggestMovers();
            updateMainTable();
            console.log('✅ All dashboard sections updated');
        }

        function updateStatistics() {
            const total = filteredData.length;
            const avgParticipation = total > 0 
                ? (filteredData.reduce((sum, s) => sum + s.participation, 0) / total).toFixed(1) 
                : 0;
            const topStore = filteredData[0];
            const aboveAverage = filteredData.filter(s => s.participation > avgParticipation).length;
            const selectedArea = document.getElementById('areaFilter').value;

            // Update totals with area context
            if (selectedArea) {
                const areaNumber = parseInt(selectedArea.substring(1));
                const areaStoresCount = filteredData.filter(s => 
                    !s.store.toUpperCase().includes('AVERAGE')
                ).length;
                document.getElementById('totalStores').innerHTML = `${areaStoresCount}<br><small style="color: var(--info-color); font-size: 0.7em;">Area ${areaNumber}<br>+ Averages</small>`;
            } else {
                document.getElementById('totalStores').textContent = total;
            }

            document.getElementById('avgParticipation').textContent = `${avgParticipation}%`;
            document.getElementById('topPerformerCount').textContent = aboveAverage;
            document.getElementById('lastUpdated').textContent = new Date().toLocaleDateString();

            if (topStore) {
                const areaInfo = selectedArea ? '' : `<br><small style="color: var(--info-color); font-size: 0.8em;">${topStore.area.display}</small>`;
                document.getElementById('topStore').innerHTML = 
                    `${topStore.store}${areaInfo}<br><small style="color: var(--primary-color); font-weight: 600;">${topStore.participation.toFixed(1)}%</small>`;
            }
        }

        function updateTopBottomStores() {
            const topDiv = document.getElementById('topStores');
            const bottomDiv = document.getElementById('bottomStores');
            
            topDiv.innerHTML = '';
            bottomDiv.innerHTML = '';

            if (filteredData.length === 0) {
                topDiv.innerHTML = '<div class="no-data">No data available</div>';
                bottomDiv.innerHTML = '<div class="no-data">No data available</div>';
                return;
            }

            // Top 5 stores
            filteredData.slice(0, 5).forEach(store => {
                topDiv.appendChild(createStoreElement(store));
            });

            // Bottom 5 stores (worst at bottom)
            filteredData.slice(-5).forEach(store => {
                bottomDiv.appendChild(createStoreElement(store));
            });
        }

        function updateBiggestMovers() {
            const moversDiv = document.getElementById('biggestMovers');
            moversDiv.innerHTML = '';

            const movers = filteredData
                .filter(s => s.movement !== 'NEW' && s.movement !== 0)
                .sort((a, b) => Math.abs(b.movement) - Math.abs(a.movement));

            if (movers.length === 0) {
                moversDiv.innerHTML = '<div class="no-data">No movement data available</div>';
                return;
            }

            movers.slice(0, 5).forEach(store => {
                const element = createStoreElement(store, true);
                moversDiv.appendChild(element);
            });
        }

        function createStoreElement(store, showMovement = false) {
            const div = document.createElement('div');
            div.className = 'store-item';

            const rank = document.createElement('div');
            rank.className = 'store-rank';
            rank.textContent = `#${store.rank}`;

            const name = document.createElement('div');
            name.className = 'store-name';
            name.textContent = store.store;

            const participation = document.createElement('div');
            participation.className = 'store-participation';
            participation.textContent = `${store.participation.toFixed(1)}%`;

            div.appendChild(rank);
            div.appendChild(name);
            div.appendChild(participation);

            if (showMovement) {
                const movement = document.createElement('div');
                movement.className = 'store-movement ' + getMovementClass(store.movement);
                movement.innerHTML = getMovementDisplay(store.movement);
                div.appendChild(movement);
            }

            return div;
        }

        function updateMainTable() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            if (filteredData.length === 0) {
                const row = tableBody.insertRow();
                row.innerHTML = '<td colspan="5" class="no-data">No data matches current filters</td>';
                return;
            }

            // Find average store positions
            const northWestAverageIndex = filteredData.findIndex(store => 
                store.store.toUpperCase().includes('NORTH WEST AVERAGE') ||
                (store.store.toUpperCase().includes('NORTH WEST') && store.store.toUpperCase().includes('AVERAGE'))
            );
            const northAverageIndex = filteredData.findIndex(store => 
                store.store.toUpperCase().includes('NORTH AVERAGE') &&
                !store.store.toUpperCase().includes('NORTH WEST')
            );

            filteredData.forEach((store, index) => {
                const row = tableBody.insertRow();
                
                // Determine row class based on position relative to averages
                let rowClass = '';
                const isNorthWestAverage = store.store.toUpperCase().includes('NORTH WEST AVERAGE') ||
                    (store.store.toUpperCase().includes('NORTH WEST') && store.store.toUpperCase().includes('AVERAGE'));
                const isNorthAverage = store.store.toUpperCase().includes('NORTH AVERAGE') &&
                    !store.store.toUpperCase().includes('NORTH WEST');
                
                if (isNorthWestAverage || isNorthAverage) {
                    rowClass = 'average-store average-divider';
                } else {
                    // Check if below averages
                    const belowNorthWestAverage = northWestAverageIndex !== -1 && index > northWestAverageIndex;
                    const belowNorthAverage = northAverageIndex !== -1 && index > northAverageIndex;
                    
                    if (belowNorthAverage) {
                        // Below North Average (worst performers) - Pink
                        rowClass = 'below-north-average';
                    } else if (belowNorthWestAverage) {
                        // Below North West Average only - Light Orange
                        rowClass = 'below-north-west-average';
                    }
                }
                
                row.className = rowClass;
                row.innerHTML = `
                    <td class="rank-cell">${store.rank}</td>
                    <td class="store-cell">${store.store}</td>
                    <td class="area-cell">${store.area.display}</td>
                    <td class="participation-cell">${store.participation.toFixed(1)}%</td>
                    <td class="movement-cell ${getMovementClass(store.movement)}">${getMovementDisplay(store.movement)}</td>
                `;
            });
        }

        function getMovementClass(movement) {
            if (movement === 'NEW') return 'movement-new';
            if (movement === 0) return 'movement-same';
            return movement > 0 ? 'movement-up' : 'movement-down';
        }

        function getMovementDisplay(movement) {
            if (movement === 'NEW') return '<span title="New Entry">🆕 NEW</span>';
            if (movement === 0) return '<span title="No Change">➖</span>';
            if (movement > 0) return `<span title="Moved up ${movement} positions">⬆️ ${movement}</span>`;
            return `<span title="Moved down ${Math.abs(movement)} positions">⬇️ ${Math.abs(movement)}</span>`;
        }

        function getTrendDisplay(store) {
            const participation = store.participation;
            if (participation >= 15) return '🔥';
            if (participation >= 10) return '⭐';
            if (participation >= 7) return '📈';
            if (participation >= 5) return '➡️';
            return '📉';
        }

        // Filter and Sort Functions
        function filterStores() {
            const searchTerm = document.getElementById('searchFilter').value.toLowerCase();
            const selectedArea = document.getElementById('areaFilter').value;
            const minParticipation = parseFloat(document.getElementById('minParticipation').value) || 0;

            filteredData = currentData.filter(store => {
                const matchesSearch = store.store.toLowerCase().includes(searchTerm);
                const matchesParticipation = store.participation >= minParticipation;
                
                // Always include NORTH WEST AVERAGE and NORTH AVERAGE stores regardless of area filter
                const isNorthWestAverage = store.store.toUpperCase().includes('NORTH WEST AVERAGE') ||
                    (store.store.toUpperCase().includes('NORTH WEST') && store.store.toUpperCase().includes('AVERAGE'));
                const isNorthAverage = store.store.toUpperCase().includes('NORTH AVERAGE') &&
                    !store.store.toUpperCase().includes('NORTH WEST');
                
                if (isNorthWestAverage || isNorthAverage) {
                    // Always include average stores if they match search and participation filters
                    return matchesSearch && matchesParticipation;
                }
                
                // For regular stores, apply area filter
                const matchesArea = !selectedArea || store.area.code === selectedArea;
                return matchesSearch && matchesArea && matchesParticipation;
            });

            sortStores();
        }

        function sortStores() {
            const sortBy = document.getElementById('sortBy').value;

            switch (sortBy) {
                case 'participation':
                    filteredData.sort((a, b) => b.participation - a.participation);
                    break;
                case 'name':
                    filteredData.sort((a, b) => a.store.localeCompare(b.store));
                    break;
                case 'area':
                    filteredData.sort((a, b) => a.area.number - b.area.number);
                    break;
                case 'movement':
                    filteredData.sort((a, b) => {
                        if (a.movement === 'NEW') return 1;
                        if (b.movement === 'NEW') return -1;
                        return b.movement - a.movement;
                    });
                    break;
                default: // rank
                    filteredData.sort((a, b) => a.rank - b.rank);
            }

            updateMainTable();
            updateStatistics();
            updateTopBottomStores(); // Added this line to update Top 5 and Bottom 5 when filters change
            updateBiggestMovers(); // Added this line to update Biggest Movers when filters change
        }

        // Admin Functions
        function toggleAdmin() {
            if (!isAdminUser) {
                alert('Admin access denied. Please use URL parameter ?admin=1');
                return;
            }
            document.getElementById('adminControls').classList.toggle('show');
        }

        function clearData() {
            if (!confirm('Are you sure you want to clear all data? This cannot be undone.')) return;
            
            localStorage.removeItem('leagueTableDataV2');
            allStoreData = [];
            previousData = [];
            currentData = [];
            filteredData = [];
            uploadHistory = [];
            
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('filterSection').style.display = 'none';
            document.getElementById('csvFile').value = '';
            
            alert('All data cleared successfully.');
        }

        function exportData() {
            if (filteredData.length === 0) {
                alert('No data to export.');
                return;
            }

            const csvContent = [
                'Rank,Store,Participation %,Movement,Previous Rank',
                ...filteredData.map(store => 
                    `${store.rank},"${store.store}",${store.participation},${store.movement === 'NEW' ? 'NEW' : store.movement},${store.previousRank || 'N/A'}`
                )
            ].join('\n');

            downloadFile(csvContent, `league_table_export_${new Date().toISOString().split('T')[0]}.csv`, 'text/csv');
            
            alert(`Exported ${filteredData.length} records successfully!`);
        }
        
        function exportJSON() {
            if (currentData.length === 0) {
                alert('No data to export. Please upload data first.');
                return;
            }
            
            const timestamp = new Date().toISOString().split('T')[0];
            const filename = `league_table_data_${timestamp}.json`;
            
            // Create comprehensive JSON export
            const jsonData = {
                metadata: {
                    exportDate: new Date().toISOString(),
                    exportTime: new Date().toLocaleString(),
                    totalStores: currentData.length,
                    dataSource: uploadHistory[uploadHistory.length - 1]?.fileName || 'Demo Data',
                    averageParticipation: (currentData.reduce((sum, s) => sum + s.participation, 0) / currentData.length).toFixed(1),
                    version: 'v2.0'
                },
                stores: currentData.map(store => ({
                    rank: store.rank,
                    store: store.store,
                    participation: store.participation,
                    movement: store.movement,
                    previousRank: store.previousRank,
                    area: {
                        code: store.area.code,
                        number: store.area.number,
                        display: store.area.display
                    }
                })),
                previousData: previousData.map(store => ({
                    store: store.store,
                    participation: store.participation,
                    areaCode: store.areaCode || null
                })),
                uploadHistory: uploadHistory,
                statistics: {
                    topStore: currentData[0],
                    bottomStore: currentData[currentData.length - 1],
                    aboveAverageCount: currentData.filter(s => s.participation > (currentData.reduce((sum, s) => sum + s.participation, 0) / currentData.length)).length,
                    availableAreas: availableAreas,
                    biggestMovers: currentData
                        .filter(s => s.movement !== 'NEW' && s.movement !== 0)
                        .sort((a, b) => Math.abs(b.movement) - Math.abs(a.movement))
                        .slice(0, 5)
                }
            };
            
            const jsonContent = JSON.stringify(jsonData, null, 2);
            downloadFile(jsonContent, filename, 'application/json');
            
            // Show success message with details
            setTimeout(() => {
                alert(
                    `📄 JSON Data Exported Successfully!\n\n` +
                    `File: ${filename}\n` +
                    `Total Stores: ${currentData.length}\n` +
                    `File Size: ~${Math.round(jsonContent.length / 1024)} KB\n\n` +
                    `This JSON file contains:\n` +
                    `• Complete store data with rankings\n` +
                    `• Area information for each store\n` +
                    `• Movement tracking data & previous rankings\n` +
                    `• Upload history and metadata\n` +
                    `• Statistics and analytics\n\n` +
                    `You can:\n` +
                    `• Share this file with other users\n` +
                    `• Load it back into the dashboard\n` +
                    `• Use it as a data backup\n` +
                    `• Import it into other systems\n\n` +
                    `The file has been downloaded to your Downloads folder.`
                );
            }, 100);
        }
        
        function importJSON() {
            if (!isAdminUser) {
                alert('Admin access required to import JSON data.');
                return;
            }
            
            // Create file input for JSON
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.style.display = 'none';
            
            input.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                if (!file.name.toLowerCase().endsWith('.json')) {
                    alert('Please select a valid JSON file.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const jsonData = JSON.parse(e.target.result);
                        
                        // Validate JSON structure
                        if (!jsonData.stores || !Array.isArray(jsonData.stores)) {
                            alert('Invalid JSON format. Missing or invalid stores data.');
                            return;
                        }
                        
                        // Import the data
                        allStoreData = jsonData.stores.map(store => ({
                            store: store.store,
                            participation: store.participation,
                            areaCode: store.area?.code || null
                        }));
                        
                        // Restore previous data for movement tracking (if available)
                        if (jsonData.previousData && Array.isArray(jsonData.previousData)) {
                            previousData = jsonData.previousData.map(store => ({
                                store: store.store,
                                participation: store.participation,
                                areaCode: store.areaCode || null
                            }));
                            console.log('✅ Restored previous data for movement tracking:', previousData.length, 'stores');
                        } else {
                            // If no previous data in JSON, use current allStoreData as previous
                            // This will result in 'NEW' movements for all stores
                            previousData = [];
                            console.log('⚠️ No previous data found in JSON - all movements will show as NEW');
                        }
                        
                        // Update upload history
                        uploadHistory.push({
                            fileName: `${file.name} (JSON Import)`,
                            uploadTime: new Date().toLocaleString(),
                            recordCount: allStoreData.length
                        });
                        
                        // If JSON has upload history, merge it
                        if (jsonData.uploadHistory && Array.isArray(jsonData.uploadHistory)) {
                            uploadHistory = [...uploadHistory, ...jsonData.uploadHistory];
                        }
                        
                        // Process the imported data
                        processData();
                        saveDataToStorage();
                        
                        // Show success message
                        setTimeout(() => {
                            const hasMovementData = jsonData.previousData && jsonData.previousData.length > 0;
                            alert(
                                `📁 JSON Data Imported Successfully!\n\n` +
                                `File: ${file.name}\n` +
                                `Total Stores: ${allStoreData.length}\n` +
                                `Previous Data: ${hasMovementData ? jsonData.previousData.length + ' stores' : 'None (movements will show as NEW)'}\n` +
                                `Data Source: ${jsonData.metadata?.dataSource || 'Unknown'}\n` +
                                `Export Date: ${jsonData.metadata?.exportTime || 'Unknown'}\n\n` +
                                `The data has been loaded and processed.\n` +
                                `Movement tracking: ${hasMovementData ? '✅ Preserved' : '⚠️ Reset (all NEW)'}\n` +
                                `Dashboard updated with imported data.`
                            );
                        }, 100);
                        
                    } catch (error) {
                        console.error('JSON Import Error:', error);
                        alert('Error parsing JSON file: ' + error.message);
                    }
                };
                
                reader.readAsText(file);
            });
            
            // Trigger file selection
            document.body.appendChild(input);
            input.click();
            document.body.removeChild(input);
        }

        function resetRankings() {
            if (!confirm('Reset all movement tracking? This will treat all stores as new entries.')) return;
            
            previousData = [];
            currentData.forEach(store => {
                store.movement = 'NEW';
                store.previousRank = null;
            });
            
            updateDashboard();
            saveDataToStorage();
            
            alert('Rankings reset successfully. All movements cleared.');
        }

        function showDataInfo() {
            const info = `
Data Information:
• Total Records: ${currentData.length}
• Upload History: ${uploadHistory.length} files
• Last Updated: ${new Date(JSON.parse(localStorage.getItem('leagueTableDataV2') || '{}').lastUpdated || new Date()).toLocaleString()}
• Average Participation: ${currentData.length > 0 ? (currentData.reduce((s, store) => s + store.participation, 0) / currentData.length).toFixed(1) : 0}%

Recent Uploads:
${uploadHistory.slice(-3).map(h => `• ${h.fileName} (${h.recordCount} records) - ${h.uploadTime}`).join('\n')}
            `;
            alert(info);
        }

        function generateStandaloneVersion() {
            if (currentData.length === 0) {
                alert('No data available to create standalone version. Please upload data first.');
                return;
            }

            const timestamp = new Date().toISOString().split('T')[0];
            const filename = `League_Table_Standalone_${timestamp}.html`;
            
            // Create standalone HTML with embedded data
            const standaloneHTML = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store League Table Dashboard - Standalone</title>
    <style>
        :root {
            --primary-color: #007AFF;
            --primary-dark: #0056b3;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --dark-text: #1d1d1f;
            --light-text: #666;
            --border-color: #e9ecef;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-hover: 0 6px 25px rgba(0,0,0,0.12);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--dark-text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        .header { text-align: center; margin-bottom: 40px; }
        .header h1 {
            font-size: 3em; font-weight: 700;
            background: linear-gradient(45deg, var(--primary-color), var(--info-color));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; margin-bottom: 10px;
        }
        .version-badge {
            background: var(--success-color); color: white; padding: 4px 12px;
            border-radius: 20px; font-size: 0.8em; font-weight: 600; margin-left: 10px;
        }
        .subtitle { color: var(--light-text); font-size: 1.2em; }
        
        .card {
            background: white; border-radius: var(--border-radius);
            box-shadow: var(--shadow); transition: var(--transition); overflow: hidden;
        }
        .card:hover { box-shadow: var(--shadow-hover); transform: translateY(-2px); }
        
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px; margin-bottom: 30px;
        }
        .stat-card {
            padding: 30px; text-align: center; position: relative; overflow: hidden;
        }
        .stat-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--info-color));
        }
        .stat-icon {
            font-size: 2.5em; margin-bottom: 15px; opacity: 0.1;
            position: absolute; top: 20px; right: 20px;
        }
        .stat-value {
            font-size: 2.8em; font-weight: 800; color: var(--primary-color);
            margin-bottom: 10px; position: relative; z-index: 1;
        }
        .stat-label {
            font-size: 1em; color: var(--light-text); font-weight: 600;
            text-transform: uppercase; letter-spacing: 1px;
        }
        
        .content-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px; margin-bottom: 30px;
        }
        .content-section { padding: 25px; }
        .section-title {
            font-size: 1.4em; font-weight: 700; margin-bottom: 20px; color: var(--dark-text);
            border-bottom: 3px solid var(--primary-color); padding-bottom: 10px;
            display: flex; align-items: center; gap: 10px;
        }
        .section-title::before { content: attr(data-icon); font-size: 1.2em; }
        
        .store-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 0; border-bottom: 1px solid var(--border-color); transition: var(--transition);
        }
        .store-item:hover { background: var(--light-bg); padding-left: 10px; border-radius: 8px; }
        .store-item:last-child { border-bottom: none; }
        .store-rank {
            font-weight: 800; font-size: 1.2em; color: var(--primary-color);
            min-width: 40px; height: 40px; display: flex; align-items: center;
            justify-content: center; background: rgba(0, 122, 255, 0.1);
            border-radius: 50%; margin-right: 15px;
        }
        .store-name { flex: 1; font-weight: 600; font-size: 1.1em; }
        .store-participation {
            font-size: 1em; color: var(--light-text); font-weight: 700;
            background: var(--light-bg); padding: 5px 12px; border-radius: 20px; margin-right: 10px;
        }
        .store-movement {
            font-size: 1.2em; font-weight: 800; min-width: 60px; text-align: center;
            padding: 5px 10px; border-radius: 20px;
        }
        
        .movement-up { color: var(--success-color); background: rgba(40, 167, 69, 0.1); }
        .movement-down { color: var(--danger-color); background: rgba(220, 53, 69, 0.1); }
        .movement-new { color: var(--info-color); background: rgba(23, 162, 184, 0.1); }
        .movement-same { color: var(--light-text); background: var(--light-bg); }
        
        .table-section { padding: 25px; overflow-x: auto; }
        .league-table {
            width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.95em;
        }
        .league-table th {
            background: linear-gradient(45deg, var(--primary-color), var(--primary-dark));
            color: white; padding: 15px 12px; text-align: left; font-weight: 700;
            text-transform: uppercase; letter-spacing: 1px; position: sticky;
            top: 0; z-index: 10; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .league-table td {
            padding: 12px; border-bottom: 1px solid var(--border-color); transition: var(--transition);
        }
        .league-table tbody tr:hover {
            background: var(--light-bg); transform: scale(1.01); box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .rank-cell {
            font-weight: 800; text-align: center; width: 80px;
            font-size: 1.1em; color: var(--primary-color);
        }
        .participation-cell { text-align: center; font-weight: 700; width: 120px; }
        .movement-cell { text-align: center; font-weight: 800; width: 100px; }
        
        /* Average highlighting */
        .average-store {
            background: linear-gradient(45deg, #fff3cd, #ffeaa7) !important;
            font-weight: 700; border-top: 3px solid var(--warning-color);
            border-bottom: 3px solid var(--warning-color);
        }
        .below-north-west-average {
            background: rgba(255, 193, 7, 0.15) !important; border-left: 4px solid #ff9800;
        }
        .below-north-average {
            background: rgba(255, 193, 203, 0.4) !important; border-left: 4px solid #e91e63;
        }
        .below-north-west-average .rank-cell {
            background: #ff9800; color: white; border-radius: 50%; border: 3px solid #ff9800;
            width: 35px; height: 35px; display: flex; align-items: center;
            justify-content: center; margin: 0 auto; font-size: 1em; font-weight: 800;
        }
        .below-north-average .rank-cell {
            background: #e91e63; color: white; border-radius: 50%; border: 3px solid #e91e63;
            width: 35px; height: 35px; display: flex; align-items: center;
            justify-content: center; margin: 0 auto; font-size: 1em; font-weight: 800;
        }
        .average-divider { position: relative; }
        .average-divider::after {
            content: 'AVERAGE LINE'; position: absolute; right: 10px; top: 50%;
            transform: translateY(-50%); background: var(--warning-color); color: #000;
            padding: 4px 10px; font-size: 0.7em; font-weight: 800;
            border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .no-data {
            text-align: center; color: var(--light-text); font-style: italic;
            padding: 40px; font-size: 1.1em;
        }
        
        .generation-info {
            background: var(--info-color); color: white; padding: 15px;
            border-radius: var(--border-radius); margin-bottom: 25px; text-align: center;
            font-weight: 600;
        }
        
        @media (max-width: 1200px) { .content-grid { grid-template-columns: 1fr; } }
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .header h1 { font-size: 2.2em; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
            .content-grid { gap: 15px; }
        }
        @media (max-width: 480px) {
            .stats-grid { grid-template-columns: 1fr; }
            .store-item { flex-direction: column; align-items: flex-start; gap: 10px; }
            .store-rank { align-self: flex-start; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Store League Table Dashboard<span class="version-badge">Standalone</span></h1>
            <p class="subtitle">Complete Performance Report</p>
        </div>
        
        <div class="generation-info">
            📧 <strong>Standalone Version</strong> - Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
            | Total Stores: ${currentData.length} | Data Source: ${uploadHistory[uploadHistory.length - 1]?.fileName || 'Demo Data'}
        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="card stat-card">
                <div class="stat-icon">🏪</div>
                <div class="stat-value">${currentData.length}</div>
                <div class="stat-label">Total Stores</div>
            </div>
            <div class="card stat-card">
                <div class="stat-icon">📊</div>
                <div class="stat-value">${(currentData.reduce((sum, s) => sum + s.participation, 0) / currentData.length).toFixed(1)}%</div>
                <div class="stat-label">Average Participation</div>
            </div>
            <div class="card stat-card">
                <div class="stat-icon">🏆</div>
                <div class="stat-value" style="font-size: 1.8em; line-height: 1.2;">${currentData[0].store}<br><small style="color: var(--primary-color); font-weight: 600;">${currentData[0].participation.toFixed(1)}%</small></div>
                <div class="stat-label">Top Performing Store</div>
            </div>
            <div class="card stat-card">
                <div class="stat-icon">📅</div>
                <div class="stat-value">${new Date().toLocaleDateString()}</div>
                <div class="stat-label">Report Date</div>
            </div>
            <div class="card stat-card">
                <div class="stat-icon">⭐</div>
                <div class="stat-value">${currentData.filter(s => s.participation > (currentData.reduce((sum, s) => sum + s.participation, 0) / currentData.length)).length}</div>
                <div class="stat-label">Above Average</div>
            </div>
        </div>

        <!-- Content Sections -->
        <div class="content-grid">
            <div class="card content-section">
                <h3 class="section-title" data-icon="🥇">Top 5 Stores</h3>
                <div>
                    ${currentData.slice(0, 5).map(store => `
                        <div class="store-item">
                            <div class="store-rank">#${store.rank}</div>
                            <div class="store-name">${store.store}</div>
                            <div class="store-participation">${store.participation.toFixed(1)}%</div>
                        </div>
                    `).join('')}
                </div>
            </div>

            <div class="card content-section">
                <h3 class="section-title" data-icon="📉">Bottom 5 Stores</h3>
                <div>
                    ${currentData.slice(-5).reverse().map(store => `
                        <div class="store-item">
                            <div class="store-rank">#${store.rank}</div>
                            <div class="store-name">${store.store}</div>
                            <div class="store-participation">${store.participation.toFixed(1)}%</div>
                        </div>
                    `).join('')}
                </div>
            </div>

            <div class="card content-section">
                <h3 class="section-title" data-icon="🚀">Biggest Movers</h3>
                <div>
                    ${(() => {
                        const movers = currentData.filter(s => s.movement !== 'NEW' && s.movement !== 0)
                            .sort((a, b) => Math.abs(b.movement) - Math.abs(a.movement))
                            .slice(0, 5);
                        return movers.length > 0 ? movers.map(store => `
                            <div class="store-item">
                                <div class="store-rank">#${store.rank}</div>
                                <div class="store-name">${store.store}</div>
                                <div class="store-participation">${store.participation.toFixed(1)}%</div>
                                <div class="store-movement ${store.movement > 0 ? 'movement-up' : 'movement-down'}">
                                    ${store.movement > 0 ? '⬆️' : '⬇️'} ${Math.abs(store.movement)}
                                </div>
                            </div>
                        `).join('') : '<div class="no-data">No movement data available</div>';
                    })()}
                </div>
            </div>
        </div>

        <!-- Main League Table -->
        <div class="card table-section">
            <h3 class="section-title" data-icon="📋">Complete League Table</h3>
            <div style="overflow-x: auto;">
                <table class="league-table">
                    <thead>
                        <tr>
                            <th class="rank-cell">Rank</th>
                            <th>Store Name</th>
                            <th class="participation-cell">Participation %</th>
                            <th class="movement-cell">Movement</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${currentData.map((store, index) => {
                            // Find average store positions
                            const northWestAverageIndex = currentData.findIndex(s => 
                                s.store.toUpperCase().includes('NORTH WEST AVERAGE') ||
                                (s.store.toUpperCase().includes('NORTH WEST') && s.store.toUpperCase().includes('AVERAGE'))
                            );
                            const northAverageIndex = currentData.findIndex(s => 
                                s.store.toUpperCase().includes('NORTH AVERAGE') &&
                                !s.store.toUpperCase().includes('NORTH WEST')
                            );
                            
                            // Determine row class
                            let rowClass = '';
                            const isNorthWestAverage = store.store.toUpperCase().includes('NORTH WEST AVERAGE') ||
                                (store.store.toUpperCase().includes('NORTH WEST') && store.store.toUpperCase().includes('AVERAGE'));
                            const isNorthAverage = store.store.toUpperCase().includes('NORTH AVERAGE') &&
                                !store.store.toUpperCase().includes('NORTH WEST');
                            
                            if (isNorthWestAverage || isNorthAverage) {
                                rowClass = 'average-store average-divider';
                            } else {
                                const belowNorthWestAverage = northWestAverageIndex !== -1 && index > northWestAverageIndex;
                                const belowNorthAverage = northAverageIndex !== -1 && index > northAverageIndex;
                                
                                if (belowNorthAverage) {
                                    rowClass = 'below-north-average';
                                } else if (belowNorthWestAverage) {
                                    rowClass = 'below-north-west-average';
                                }
                            }
                            
                            // Movement display
                            let movementDisplay = '';
                            if (store.movement === 'NEW') movementDisplay = '<span title="New Entry">🆕 NEW</span>';
                            else if (store.movement === 0) movementDisplay = '<span title="No Change">➖</span>';
                            else if (store.movement > 0) movementDisplay = `<span title="Moved up ${store.movement} positions">⬆️ ${store.movement}</span>`;
                            else movementDisplay = `<span title="Moved down ${Math.abs(store.movement)} positions">⬇️ ${Math.abs(store.movement)}</span>`;
                            
                            return `
                                <tr class="${rowClass}">
                                    <td class="rank-cell">${store.rank}</td>
                                    <td class="store-cell">${store.store}</td>
                                    <td class="participation-cell">${store.participation.toFixed(1)}%</td>
                                    <td class="movement-cell">${movementDisplay}</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>`;

            // Download the standalone file
            downloadFile(standaloneHTML, filename, 'text/html');
            
            // Show success message
            setTimeout(() => {
                alert(
                    `📧 Standalone Version Created Successfully!\n\n` +
                    `File: ${filename}\n` +
                    `Total Stores: ${currentData.length}\n` +
                    `File Size: ~${Math.round(standaloneHTML.length / 1024)} KB\n\n` +
                    `This file contains:\n` +
                    `• All current data embedded\n` +
                    `• Complete styling & functionality\n` +
                    `• No external dependencies\n` +
                    `• Ready to email or share\n\n` +
                    `The file has been downloaded to your Downloads folder.`
                );
            }, 100);
        }

        // Utility Functions
        function downloadFile(content, fileName, contentType) {
            const a = document.createElement('a');
            const file = new Blob([content], { type: contentType });
            a.href = URL.createObjectURL(file);
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(a.href);
        }

        // Keyboard Shortcuts
        document.addEventListener('keydown', function(e) {
            // Admin access toggle (Option+A on Mac, Alt+A on PC)
            if ((e.altKey || e.metaKey) && e.key.toLowerCase() === 'a') {
                e.preventDefault();
                toggleAdminMode();
                return;
            }
            
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'u':
                        e.preventDefault();
                        if (isAdminUser) document.getElementById('csvFile').click();
                        break;
                    case 'e':
                        e.preventDefault();
                        if (isAdminUser) exportData();
                        break;
                    case 'f':
                        e.preventDefault();
                        document.getElementById('searchFilter').focus();
                        break;
                }
            }
        });
        
        // Toggle Admin Mode
        function toggleAdminMode() {
            isAdminUser = !isAdminUser;
            const uploadSection = document.getElementById('uploadSection');
            const adminNotice = document.getElementById('adminNotice');
            
            if (isAdminUser) {
                uploadSection.classList.add('show-admin');
                adminNotice.style.display = 'block';
                alert('🔓 Admin Mode Enabled!\n\nYou can now:\n• Upload CSV files\n• Export data\n• Generate standalone versions\n\nKeyboard shortcuts:\n• Cmd+U (Upload)\n• Cmd+E (Export)\n• Cmd+F (Search)');
            } else {
                uploadSection.classList.remove('show-admin');
                adminNotice.style.display = 'none';
                alert('🔒 Admin Mode Disabled');
            }
        }

        // Auto-save every 30 seconds
        setInterval(() => {
            if (currentData.length > 0) {
                saveDataToStorage();
            }
        }, 30000);

        console.log('🚀 League Table Dashboard v2.0 Loaded Successfully!');
        console.log('💡 Keyboard shortcuts:');
        console.log('  • Option+A / Alt+A: Toggle Admin Mode');
        console.log('  • Cmd+U / Ctrl+U: Upload CSV (Admin)');
        console.log('  • Cmd+E / Ctrl+E: Export Data (Admin)');
        console.log('  • Cmd+F / Ctrl+F: Focus Search');
        console.log('📊 Current data loaded:', currentData.length, 'stores');
        console.log('🔧 Admin mode:', isAdminUser ? 'Enabled' : 'Disabled');

        // Auto-Embed Current Data Function
        function autoEmbedCurrentData() {
            if (!isAdminUser) {
                alert('Admin access required to embed data.');
                return;
            }
            
            if (currentData.length === 0) {
                alert('No data currently loaded in dashboard.\n\nPlease:\n1. Upload a CSV file, or\n2. Load data from URL, or\n3. Import JSON data\n\nThen try the Auto-Embed feature.');
                return;
            }
            
            if (!confirm(`🔧 Auto-Embed Current Data\n\nThis will embed the current dashboard data (${currentData.length} stores) directly into the HTML file for permanent storage.\n\nBenefits:\n• Data will load instantly on page refresh\n• No need to re-upload files\n• Works offline\n\nClick OK to proceed with embedding.`)) {
                return;
            }
            
            try {
                console.log('🔧 Starting auto-embed process...');
                
                // Create comprehensive JSON data structure
                const jsonData = {
                    metadata: {
                        exportDate: new Date().toISOString(),
                        exportTime: new Date().toLocaleString(),
                        totalStores: currentData.length,
                        dataSource: uploadHistory[uploadHistory.length - 1]?.fileName || 'Dashboard Data',
                        averageParticipation: currentData.length > 0 
                            ? (currentData.reduce((sum, s) => sum + s.participation, 0) / currentData.length).toFixed(1)
                            : '0',
                        version: 'v2.0',
                        autoEmbedded: true,
                        embedTime: new Date().toLocaleString()
                    },
                    stores: currentData.map(store => ({
                        rank: store.rank,
                        store: store.store,
                        participation: store.participation,
                        movement: store.movement,
                        previousRank: store.previousRank,
                        area: {
                            code: store.area.code,
                            number: store.area.number,
                            display: store.area.display
                        },
                        areaCode: store.area.code
                    })),
                    previousData: previousData.map(store => ({
                        store: store.store,
                        participation: store.participation,
                        areaCode: store.areaCode || null
                    })),
                    uploadHistory: uploadHistory,
                    statistics: {
                        topStore: currentData[0],
                        bottomStore: currentData[currentData.length - 1],
                        aboveAverageCount: currentData.filter(s => s.participation > (currentData.reduce((sum, s) => sum + s.participation, 0) / currentData.length)).length,
                        availableAreas: [...new Set(currentData.map(s => s.area.code))].filter(code => code !== 'UNKNOWN').sort(),
                        biggestMovers: currentData
                            .filter(s => s.movement !== 'NEW' && s.movement !== 0)
                            .sort((a, b) => Math.abs(b.movement) - Math.abs(a.movement))
                            .slice(0, 5)
                    }
                };
                
                // Create downloadable file for user to manually update
                const timestamp = new Date().toISOString().split('T')[0];
                const filename = `auto_embed_data_${timestamp}.json`;
                const jsonContent = JSON.stringify(jsonData, null, 2);
                
                // Download the JSON file
                downloadFile(jsonContent, filename, 'application/json');
                
                // Show instructions
                setTimeout(() => {
                    alert(`🎉 Auto-Embed Data Generated!\n\n` +
                          `📄 File Downloaded: ${filename}\n` +
                          `📊 Stores: ${currentData.length}\n` +
                          `🕒 Generated: ${new Date().toLocaleString()}\n\n` +
                          `📋 Next Steps:\n` +
                          `1. Find the downloaded ${filename} file\n` +
                          `2. Run the update script:\n` +
                          `   python3 update_dashboard.py "~/Downloads/${filename}"\n\n` +
                          `OR use the Quick Update button below for automated embedding!`);
                    
                    // Show quick update option
                    if (confirm('🚀 Quick Update Available!\n\nWould you like to automatically run the embed script now?\n\n(This will update the HTML file immediately)')) {
                        quickEmbedFromGenerated(filename, jsonData);
                    }
                }, 200);
                
            } catch (error) {
                console.error('❌ Auto-embed error:', error);
                alert(`❌ Error during auto-embed: ${error.message}`);
            }
        }
        
        // Quick Embed Function (simulates the Python script)
        function quickEmbedFromGenerated(filename, jsonData) {
            try {
                console.log('⚡ Running quick embed...');
                
                // Update the embedded data variable (this simulates what the Python script does)
                window.EMBEDDED_LEAGUE_DATA = jsonData;
                
                // Save to localStorage as backup
                localStorage.setItem('leagueTableEmbeddedBackup', JSON.stringify(jsonData));
                
                console.log('✅ Quick embed completed successfully!');
                
                alert(`✅ Quick Embed Successful!\n\n` +
                      `🔄 The data has been embedded in memory.\n` +
                      `📋 To make it permanent:\n\n` +
                      `1. Use the downloaded ${filename}\n` +
                      `2. Run: python3 update_dashboard.py\n\n` +
                      `💾 Temporary embed is active for this session!`);
                
            } catch (error) {
                console.error('❌ Quick embed error:', error);
                alert(`❌ Quick embed failed: ${error.message}`);
            }
        }
        
        // Show Embed Instructions Function
        function showEmbedInstructions() {
            const instructions = `📋 Auto-Embed Instructions\n` +
                               `==========================\n\n` +
                               `🎯 Purpose:\n` +
                               `The Auto-Embed feature saves your current dashboard data directly into the HTML file, so it loads instantly every time you open the dashboard.\n\n` +
                               `🔄 How It Works:\n` +
                               `1. Click "🔧 Auto-Embed Current Data"\n` +
                               `2. System generates a JSON file with your data\n` +
                               `3. Choose Quick Update for instant embedding\n` +
                               `4. Or use the Python script for permanent embedding\n\n` +
                               `⚡ Quick Update vs Permanent:\n` +
                               `• Quick: Works for current browser session\n` +
                               `• Permanent: Updates the actual HTML file\n\n` +
                               `🔧 Manual Method:\n` +
                               `If auto-embed doesn’t work, you can always:\n` +
                               `1. Export JSON data from admin controls\n` +
                               `2. Run: python3 update_dashboard.py [file.json]\n` +
                               `3. This guarantees permanent embedding\n\n` +
                               `🔑 Requirements:\n` +
                               `• Admin mode must be enabled\n` +
                               `• Data must be loaded in dashboard\n` +
                               `• Modern browser for best results`;
            
            alert(instructions);
        }
        
        // Load Embedded Data Function
        function loadEmbeddedData(showAlert = true) {
            console.log('📋 Loading embedded data...');
            
            try {
                // Clear existing data
                previousData = [...allStoreData];
                
                // Load from embedded JSON
                const embeddedData = window.EMBEDDED_LEAGUE_DATA;
                if (!embeddedData || !embeddedData.stores) {
                    throw new Error('No embedded data found');
                }
                
                console.log('✅ Embedded data found:', embeddedData.metadata);
                
                // Convert embedded data to internal format
                allStoreData = embeddedData.stores.map(store => {
                    let movement = 'NEW';
                    if (store.movement !== undefined && store.movement !== null) {
                        if (typeof store.movement === 'string') {
                            if (store.movement === '0' || store.movement === 0) {
                                movement = 0;
                            } else if (store.movement.startsWith('+')) {
                                movement = parseInt(store.movement.substring(1));
                            } else if (store.movement.startsWith('-')) {
                                movement = -parseInt(store.movement.substring(1));
                            } else if (!isNaN(parseInt(store.movement))) {
                                movement = parseInt(store.movement);
                            }
                        } else if (typeof store.movement === 'number') {
                            movement = store.movement;
                        }
                    } else if (store.previousRank && store.rank) {
                        movement = store.previousRank - store.rank;
                    }
                    
                    return {
                        store: store.store,
                        participation: store.participation || 0,
                        rank: store.rank || 0,
                        movement: movement,
                        previousRank: store.previousRank || null,
                        area: store.area || { code: 'UNKNOWN', number: 0, display: 'Unknown' }
                    };
                });
                
                // Add to upload history
                uploadHistory.push({
                    fileName: 'Embedded Data (Local)',
                    uploadTime: embeddedData.metadata ? embeddedData.metadata.exportTime : new Date().toLocaleString(),
                    recordCount: allStoreData.length,
                    source: 'Embedded'
                });
                
                // Process and display data
                processData();
                saveDataToStorage();
                
                // Show success message
                const movedUp = allStoreData.filter(s => typeof s.movement === 'number' && s.movement > 0).length;
                const movedDown = allStoreData.filter(s => typeof s.movement === 'number' && s.movement < 0).length;
                const stayedSame = allStoreData.filter(s => s.movement === 0).length;
                const newStores = allStoreData.filter(s => s.movement === 'NEW').length;
                
                console.log(`✅ Embedded data loaded: ${allStoreData.length} stores from ${embeddedData.metadata ? embeddedData.metadata.dataSource : 'Unknown'}`);
                
                if (showAlert) {
                    alert(`✅ Embedded data loaded successfully!\n\n` +
                          `📊 Stores loaded: ${allStoreData.length}\n` +
                          `📊 Source: ${embeddedData.metadata ? embeddedData.metadata.dataSource : 'Unknown'}\n` +
                          `📊 Export Time: ${embeddedData.metadata ? embeddedData.metadata.exportTime : 'Unknown'}\n` +
                          `📊 Average: ${embeddedData.metadata ? embeddedData.metadata.averageParticipation + '%' : 'Unknown'}\n\n` +
                          `📈 Movement Summary:\n` +
                          `🔺 Moved Up: ${movedUp}\n` +
                          `🔻 Moved Down: ${movedDown}\n` +
                          `➖ Stayed Same: ${stayedSame}\n` +
                          `🆕 New Stores: ${newStores}\n\n` +
                          `💻 Loaded from embedded data!`);
                }
                
            } catch (error) {
                console.error('❌ Error loading embedded data:', error);
                alert(`❌ Error loading embedded data: ${error.message}`);
            }
        }
    </script>

    <!-- EMBEDDED JSON DATA - UPDATE THIS SECTION DAILY -->
    <script>
        // 📋 DAILY UPDATE SECTION - Replace the data below with your latest JSON
        // Last updated: 09/12/2025, 10:18:57 AM (league_table_data_2025-09-12_fixed.json)
        // 📋 DAILY UPDATE SECTION - Replace the data below with your latest JSON
        // Last updated: 09/12/2025, 10:18:57 AM (league_table_data_2025-09-12_fixed.json)
window.EMBEDDED_LEAGUE_DATA = {
  "metadata": {
    "exportDate": "2025-09-12T09:10:07.808Z",
    "exportTime": "9/12/2025, 10:10:07 AM",
    "totalStores": 180,
    "dataSource": "Day4.csv",
    "averageParticipation": "5.4",
    "version": "v2.0"
  },
  "stores": [
    {
      "rank": 1,
      "store": "DOUGLAS - ISLE OF MAN",
      "participation": 17.02,
      "movement": 0,
      "previousRank": 1,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 2,
      "store": "HALIFAX",
      "participation": 10.05,
      "movement": 0,
      "previousRank": 2,
      "area": {
        "code": "A040",
        "number": 40,
        "display": "Area 40"
      },
      "areaCode": "A040"
    },
    {
      "rank": 3,
      "store": "PADIHAM",
      "participation": 9.78,
      "movement": 0,
      "previousRank": 3,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 4,
      "store": "WHITCHURCH",
      "participation": 8.85,
      "movement": 0,
      "previousRank": 4,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 5,
      "store": "CARNFORTH",
      "participation": 8.53,
      "movement": 0,
      "previousRank": 5,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 6,
      "store": "TRAFFORD PARK",
      "participation": 8.13,
      "movement": 0,
      "previousRank": 6,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 7,
      "store": "NORTHWICH",
      "participation": 8.11,
      "movement": 0,
      "previousRank": 7,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 8,
      "store": "DARWEN",
      "participation": 8.07,
      "movement": 0,
      "previousRank": 8,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 9,
      "store": "GLOSSOP",
      "participation": 8.02,
      "movement": 0,
      "previousRank": 9,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 10,
      "store": "WINSFORD",
      "participation": 7.88,
      "movement": 0,
      "previousRank": 10,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 11,
      "store": "WOLVERHAMPTON - DUNSTALL HILL",
      "participation": 7.78,
      "movement": 0,
      "previousRank": 11,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 12,
      "store": "CANNOCK",
      "participation": 7.69,
      "movement": 0,
      "previousRank": 12,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 13,
      "store": "TELFORD - STAFFORD PARK",
      "participation": 7.68,
      "movement": 0,
      "previousRank": 13,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 14,
      "store": "WELSHPOOL",
      "participation": 7.59,
      "movement": 0,
      "previousRank": 14,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 15,
      "store": "WEST BROMWICH",
      "participation": 7.58,
      "movement": 0,
      "previousRank": 15,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 16,
      "store": "MANCHESTER - ANCOATS",
      "participation": 7.53,
      "movement": 0,
      "previousRank": 16,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 17,
      "store": "RUGBY",
      "participation": 7.49,
      "movement": 0,
      "previousRank": 17,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 18,
      "store": "COVENTRY - TILE HILL",
      "participation": 7.45,
      "movement": 0,
      "previousRank": 18,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 19,
      "store": "BRIERLEY HILL",
      "participation": 7.43,
      "movement": 0,
      "previousRank": 19,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 20,
      "store": "COVENTRY - BINLEY",
      "participation": 7.38,
      "movement": 0,
      "previousRank": 20,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 21,
      "store": "DUDLEY",
      "participation": 7.34,
      "movement": 0,
      "previousRank": 21,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 22,
      "store": "BIRKENHEAD",
      "participation": 7.3,
      "movement": 0,
      "previousRank": 22,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 23,
      "store": "MACCLESFIELD",
      "participation": 7.25,
      "movement": 0,
      "previousRank": 23,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 24,
      "store": "HINCKLEY",
      "participation": 7.11,
      "movement": 0,
      "previousRank": 24,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 25,
      "store": "MINWORTH",
      "participation": 6.88,
      "movement": 0,
      "previousRank": 25,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 26,
      "store": "BANGOR - GWYNEDD",
      "participation": 6.79,
      "movement": 0,
      "previousRank": 26,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 27,
      "store": "ERDINGTON",
      "participation": 6.76,
      "movement": 0,
      "previousRank": 27,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 28,
      "store": "KIDDERMINSTER - EASTER PARK",
      "participation": 6.7,
      "movement": 1,
      "previousRank": 29,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 29,
      "store": "ASTON",
      "participation": 6.7,
      "movement": -1,
      "previousRank": 28,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 30,
      "store": "BACUP",
      "participation": 6.69,
      "movement": 0,
      "previousRank": 30,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 31,
      "store": "KNUTSFORD",
      "participation": 6.67,
      "movement": 0,
      "previousRank": 31,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 32,
      "store": "COVENTRY - HENLEY GREEN",
      "participation": 6.62,
      "movement": 0,
      "previousRank": 32,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 33,
      "store": "LICHFIELD",
      "participation": 6.62,
      "movement": 0,
      "previousRank": 33,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 34,
      "store": "WARRINGTON - KERFOOT STREET",
      "participation": 6.56,
      "movement": 0,
      "previousRank": 34,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 35,
      "store": "LIVERPOOL - SANDHILLS",
      "participation": 6.55,
      "movement": 0,
      "previousRank": 35,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 36,
      "store": "NEWCASTLE-UNDER-LYME - CHESTERTON",
      "participation": 6.54,
      "movement": 0,
      "previousRank": 36,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 37,
      "store": "WALKDEN",
      "participation": 6.54,
      "movement": 0,
      "previousRank": 37,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 38,
      "store": "BOLTON",
      "participation": 6.5,
      "movement": 1,
      "previousRank": 39,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 39,
      "store": "BILSTON",
      "participation": 6.5,
      "movement": -1,
      "previousRank": 38,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 40,
      "store": "RADCLIFFE",
      "participation": 6.49,
      "movement": 0,
      "previousRank": 40,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 41,
      "store": "BURNTWOOD",
      "participation": 6.47,
      "movement": 0,
      "previousRank": 41,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 42,
      "store": "WARRINGTON - LATCHFORD",
      "participation": 6.47,
      "movement": 0,
      "previousRank": 42,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 43,
      "store": "ASHBOURNE",
      "participation": 6.39,
      "movement": 0,
      "previousRank": 43,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 44,
      "store": "OLDHAM - HOLLINWOOD",
      "participation": 6.39,
      "movement": 0,
      "previousRank": 44,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 45,
      "store": "CAERNARFON",
      "participation": 6.31,
      "movement": 0,
      "previousRank": 45,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 46,
      "store": "ORMSKIRK",
      "participation": 6.28,
      "movement": 0,
      "previousRank": 46,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 47,
      "store": "HOLMES CHAPEL",
      "participation": 6.24,
      "movement": 0,
      "previousRank": 47,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 48,
      "store": "WEDNESBURY",
      "participation": 6.2,
      "movement": 0,
      "previousRank": 48,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 49,
      "store": "ROCHDALE - MILNROW ROAD",
      "participation": 6.19,
      "movement": 0,
      "previousRank": 49,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 50,
      "store": "LUDLOW",
      "participation": 6.12,
      "movement": 0,
      "previousRank": 50,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 51,
      "store": "HAMSTEAD",
      "participation": 6.08,
      "movement": 0,
      "previousRank": 51,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 52,
      "store": "SELLY OAK",
      "participation": 6.08,
      "movement": 0,
      "previousRank": 52,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 53,
      "store": "KIRKBY",
      "participation": 6.07,
      "movement": 0,
      "previousRank": 53,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 54,
      "store": "HALESOWEN",
      "participation": 6.04,
      "movement": 0,
      "previousRank": 54,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 55,
      "store": "SWINTON - GREATER MANCHESTER",
      "participation": 6.04,
      "movement": 0,
      "previousRank": 55,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 56,
      "store": "BOOTLE",
      "participation": 6.03,
      "movement": 0,
      "previousRank": 56,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 57,
      "store": "COLWYN BAY - MOCHDRE",
      "participation": 5.93,
      "movement": 0,
      "previousRank": 57,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 58,
      "store": "SOLIHULL",
      "participation": 5.86,
      "movement": 0,
      "previousRank": 58,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 59,
      "store": "COLESHILL",
      "participation": 5.85,
      "movement": 0,
      "previousRank": 59,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 60,
      "store": "SMETHWICK",
      "participation": 5.84,
      "movement": 0,
      "previousRank": 60,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 61,
      "store": "LLANGEFNI",
      "participation": 5.83,
      "movement": 0,
      "previousRank": 61,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 62,
      "store": "IRLAM",
      "participation": 5.74,
      "movement": 0,
      "previousRank": 62,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 63,
      "store": "TUNSTALL",
      "participation": 5.71,
      "movement": 0,
      "previousRank": 63,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 64,
      "store": "NORTH",
      "participation": 5.66,
      "movement": "NEW",
      "previousRank": null,
      "area": {
        "code": "UNKNOWN",
        "number": 0,
        "display": "No Area"
      }
    },
    {
      "rank": 65,
      "store": "SPEKE",
      "participation": 5.66,
      "movement": -1,
      "previousRank": 64,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 66,
      "store": "WIDNES",
      "participation": 5.65,
      "movement": -1,
      "previousRank": 65,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 67,
      "store": "ALTRINCHAM",
      "participation": 5.63,
      "movement": -1,
      "previousRank": 66,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 68,
      "store": "UTTOXETER",
      "participation": 5.62,
      "movement": 0,
      "previousRank": 68,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 69,
      "store": "BRADFORD - THORNTON ROAD IND EST",
      "participation": 5.61,
      "movement": 0,
      "previousRank": 69,
      "area": {
        "code": "A040",
        "number": 40,
        "display": "Area 40"
      },
      "areaCode": "A040"
    },
    {
      "rank": 70,
      "store": "NUNEATON",
      "participation": 5.6,
      "movement": 0,
      "previousRank": 70,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 71,
      "store": "WALSALL WOOD",
      "participation": 5.6,
      "movement": 0,
      "previousRank": 71,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 72,
      "store": "BARROW-IN-FURNESS",
      "participation": 5.57,
      "movement": 0,
      "previousRank": 72,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 73,
      "store": "BAMBER BRIDGE",
      "participation": 5.56,
      "movement": 0,
      "previousRank": 73,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 74,
      "store": "SUTTON COLDFIELD",
      "participation": 5.52,
      "movement": 0,
      "previousRank": 74,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 75,
      "store": "COVENTRY - FOLESHILL",
      "participation": 5.5,
      "movement": 0,
      "previousRank": 75,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 76,
      "store": "KIRKHAM",
      "participation": 5.43,
      "movement": 0,
      "previousRank": 76,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 77,
      "store": "NORTH WEST AVERAGE",
      "participation": 5.38,
      "movement": 1,
      "previousRank": 78,
      "area": {
        "code": "UNKNOWN",
        "number": 0,
        "display": "No Area"
      }
    },
    {
      "rank": 78,
      "store": "BRADFORD - BOWLING",
      "participation": 5.38,
      "movement": -1,
      "previousRank": 77,
      "area": {
        "code": "A040",
        "number": 40,
        "display": "Area 40"
      },
      "areaCode": "A040"
    },
    {
      "rank": 79,
      "store": "ST HELENS",
      "participation": 5.35,
      "movement": 0,
      "previousRank": 79,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 80,
      "store": "BINGLEY - CROSSFLATTS",
      "participation": 5.32,
      "movement": 0,
      "previousRank": 80,
      "area": {
        "code": "A040",
        "number": 40,
        "display": "Area 40"
      },
      "areaCode": "A040"
    },
    {
      "rank": 81,
      "store": "AINTREE",
      "participation": 5.29,
      "movement": 0,
      "previousRank": 81,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 82,
      "store": "WALSALL",
      "participation": 5.28,
      "movement": 2,
      "previousRank": 84,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 83,
      "store": "ACCRINGTON",
      "participation": 5.28,
      "movement": -1,
      "previousRank": 82,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 84,
      "store": "MIDDLETON",
      "participation": 5.28,
      "movement": -1,
      "previousRank": 83,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 85,
      "store": "WOLVERHAMPTON - WILLENHALL",
      "participation": 5.24,
      "movement": 2,
      "previousRank": 87,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 86,
      "store": "LIVERPOOL - OLD SWAN",
      "participation": 5.24,
      "movement": 0,
      "previousRank": 86,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 87,
      "store": "LIVERPOOL - ERSKINE",
      "participation": 5.24,
      "movement": -2,
      "previousRank": 85,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 88,
      "store": "BROUGHTON ASTLEY",
      "participation": 5.23,
      "movement": 0,
      "previousRank": 88,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 89,
      "store": "SHREWSBURY - KNIGHTS WAY",
      "participation": 5.2,
      "movement": 0,
      "previousRank": 89,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 90,
      "store": "HINDLEY GREEN",
      "participation": 5.19,
      "movement": 0,
      "previousRank": 90,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 91,
      "store": "STOKE - ETRURIA WAY",
      "participation": 5.18,
      "movement": 0,
      "previousRank": 91,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 92,
      "store": "ROWLEY REGIS",
      "participation": 5.14,
      "movement": 0,
      "previousRank": 92,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 93,
      "store": "RUNCORN",
      "participation": 5.14,
      "movement": 0,
      "previousRank": 93,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 94,
      "store": "KENDAL",
      "participation": 5.12,
      "movement": 0,
      "previousRank": 94,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 95,
      "store": "CLITHEROE - BARROW",
      "participation": 5.1,
      "movement": 0,
      "previousRank": 95,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 96,
      "store": "WIGAN - INCE",
      "participation": 5.09,
      "movement": 1,
      "previousRank": 97,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 97,
      "store": "STAFFORD",
      "participation": 5.09,
      "movement": -1,
      "previousRank": 96,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 98,
      "store": "BLACKPOOL - VICARAGE LANE",
      "participation": 5.08,
      "movement": 0,
      "previousRank": 98,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 99,
      "store": "TYSELEY",
      "participation": 5.08,
      "movement": 0,
      "previousRank": 99,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 100,
      "store": "RUGELEY",
      "participation": 5.07,
      "movement": 0,
      "previousRank": 100,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 101,
      "store": "BLACKPOOL - MOWBRAY DRIVE",
      "participation": 5.06,
      "movement": 0,
      "previousRank": 101,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 102,
      "store": "STOCKPORT - BREDBURY",
      "participation": 5.04,
      "movement": 0,
      "previousRank": 102,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 103,
      "store": "LUTTERWORTH",
      "participation": 5.01,
      "movement": 0,
      "previousRank": 103,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 104,
      "store": "SALFORD",
      "participation": 5.01,
      "movement": 0,
      "previousRank": 104,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 105,
      "store": "WIGAN - SADDLE JUNCTION",
      "participation": 4.98,
      "movement": 0,
      "previousRank": 105,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 106,
      "store": "DEESIDE",
      "participation": 4.97,
      "movement": 0,
      "previousRank": 106,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 107,
      "store": "SHREWSBURY - LONGDEN ROAD",
      "participation": 4.96,
      "movement": 0,
      "previousRank": 107,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 108,
      "store": "LEEK",
      "participation": 4.9,
      "movement": 0,
      "previousRank": 108,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 109,
      "store": "ULVERSTON",
      "participation": 4.84,
      "movement": 0,
      "previousRank": 109,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 110,
      "store": "STOURBRIDGE",
      "participation": 4.81,
      "movement": 1,
      "previousRank": 111,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 111,
      "store": "CREWE",
      "participation": 4.81,
      "movement": -1,
      "previousRank": 110,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 112,
      "store": "TAMWORTH - NINIAN WAY",
      "participation": 4.81,
      "movement": 0,
      "previousRank": 112,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 113,
      "store": "TRENTHAM",
      "participation": 4.79,
      "movement": 0,
      "previousRank": 113,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 114,
      "store": "LANCASTER - WHITE LUND IND EST",
      "participation": 4.78,
      "movement": 0,
      "previousRank": 114,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 115,
      "store": "STOCKPORT - HEATON CHAPEL",
      "participation": 4.77,
      "movement": 1,
      "previousRank": 116,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 116,
      "store": "PENRITH",
      "participation": 4.77,
      "movement": -1,
      "previousRank": 115,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 117,
      "store": "COVENTRY - EDGWICK",
      "participation": 4.76,
      "movement": 0,
      "previousRank": 117,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 118,
      "store": "ELLESMERE PORT",
      "participation": 4.73,
      "movement": 0,
      "previousRank": 118,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 119,
      "store": "CHORLTON",
      "participation": 4.69,
      "movement": 0,
      "previousRank": 119,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 120,
      "store": "BRIDGNORTH",
      "participation": 4.66,
      "movement": 0,
      "previousRank": 120,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 121,
      "store": "CHORLEY",
      "participation": 4.66,
      "movement": 0,
      "previousRank": 121,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 122,
      "store": "KINGS NORTON",
      "participation": 4.65,
      "movement": 0,
      "previousRank": 122,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 123,
      "store": "SKIPTON",
      "participation": 4.64,
      "movement": 0,
      "previousRank": 123,
      "area": {
        "code": "A040",
        "number": 40,
        "display": "Area 40"
      },
      "areaCode": "A040"
    },
    {
      "rank": 124,
      "store": "HAYDOCK",
      "participation": 4.63,
      "movement": 0,
      "previousRank": 124,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 125,
      "store": "HORSFORTH",
      "participation": 4.63,
      "movement": 0,
      "previousRank": 125,
      "area": {
        "code": "A040",
        "number": 40,
        "display": "Area 40"
      },
      "areaCode": "A040"
    },
    {
      "rank": 126,
      "store": "TELFORD - HADLEY TRADE PARK",
      "participation": 4.62,
      "movement": 0,
      "previousRank": 126,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 127,
      "store": "ASHTON-UNDER-LYNE",
      "participation": 4.59,
      "movement": 0,
      "previousRank": 127,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 128,
      "store": "CONGLETON",
      "participation": 4.59,
      "movement": 0,
      "previousRank": 128,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 129,
      "store": "SOUTHPORT",
      "participation": 4.57,
      "movement": 0,
      "previousRank": 129,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 130,
      "store": "STOCKPORT - HIGHER HILLGATE",
      "participation": 4.55,
      "movement": 2,
      "previousRank": 132,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 131,
      "store": "BURNLEY",
      "participation": 4.55,
      "movement": -1,
      "previousRank": 130,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 132,
      "store": "NELSON",
      "participation": 4.55,
      "movement": -1,
      "previousRank": 131,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 133,
      "store": "SHELDON",
      "participation": 4.53,
      "movement": 0,
      "previousRank": 133,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 134,
      "store": "HUYTON",
      "participation": 4.46,
      "movement": 0,
      "previousRank": 134,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 135,
      "store": "LEIGH",
      "participation": 4.42,
      "movement": 0,
      "previousRank": 135,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 136,
      "store": "RUBERY",
      "participation": 4.39,
      "movement": 0,
      "previousRank": 136,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 137,
      "store": "LEYLAND - PEREGRINE PLACE IND EST",
      "participation": 4.37,
      "movement": 0,
      "previousRank": 137,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 138,
      "store": "BLACKBURN",
      "participation": 4.33,
      "movement": 0,
      "previousRank": 138,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 139,
      "store": "MOLD",
      "participation": 4.29,
      "movement": 0,
      "previousRank": 139,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 140,
      "store": "PRESTON",
      "participation": 4.25,
      "movement": 0,
      "previousRank": 140,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 141,
      "store": "TAMWORTH - BONEHILL ROAD",
      "participation": 4.19,
      "movement": 0,
      "previousRank": 141,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 142,
      "store": "NEWPORT - SHROPSHIRE",
      "participation": 4.08,
      "movement": 0,
      "previousRank": 142,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 143,
      "store": "COVENTRY - WILLENHALL",
      "participation": 4.07,
      "movement": 0,
      "previousRank": 143,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 144,
      "store": "DENBIGH",
      "participation": 4.04,
      "movement": 1,
      "previousRank": 145,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 145,
      "store": "PUDSEY",
      "participation": 4.04,
      "movement": 2,
      "previousRank": 147,
      "area": {
        "code": "A040",
        "number": 40,
        "display": "Area 40"
      },
      "areaCode": "A040"
    },
    {
      "rank": 146,
      "store": "CARLISLE - KINGSTOWN",
      "participation": 4.04,
      "movement": -2,
      "previousRank": 144,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 147,
      "store": "KEIGHLEY",
      "participation": 4.04,
      "movement": -1,
      "previousRank": 146,
      "area": {
        "code": "A040",
        "number": 40,
        "display": "Area 40"
      },
      "areaCode": "A040"
    },
    {
      "rank": 148,
      "store": "BURY",
      "participation": 4.03,
      "movement": 0,
      "previousRank": 148,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 149,
      "store": "NANTWICH",
      "participation": 4,
      "movement": 0,
      "previousRank": 149,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 150,
      "store": "CHEADLE - STANLEY GREEN",
      "participation": 3.88,
      "movement": 0,
      "previousRank": 150,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 151,
      "store": "FLEETWOOD",
      "participation": 3.88,
      "movement": 0,
      "previousRank": 151,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 152,
      "store": "STOKE - BURSLEM",
      "participation": 3.86,
      "movement": 0,
      "previousRank": 152,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 153,
      "store": "SHIPLEY",
      "participation": 3.84,
      "movement": 0,
      "previousRank": 153,
      "area": {
        "code": "A040",
        "number": 40,
        "display": "Area 40"
      },
      "areaCode": "A040"
    },
    {
      "rank": 154,
      "store": "WALLASEY - MORETON",
      "participation": 3.82,
      "movement": 0,
      "previousRank": 154,
      "area": {
        "code": "A033",
        "number": 33,
        "display": "Area 33"
      },
      "areaCode": "A033"
    },
    {
      "rank": 155,
      "store": "SHARSTON",
      "participation": 3.81,
      "movement": 0,
      "previousRank": 155,
      "area": {
        "code": "A032",
        "number": 32,
        "display": "Area 32"
      },
      "areaCode": "A032"
    },
    {
      "rank": 156,
      "store": "CHESTER",
      "participation": 3.78,
      "movement": 0,
      "previousRank": 156,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 157,
      "store": "BROMBOROUGH",
      "participation": 3.77,
      "movement": 0,
      "previousRank": 157,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 158,
      "store": "OSWESTRY",
      "participation": 3.77,
      "movement": 0,
      "previousRank": 158,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 159,
      "store": "KINGS HEATH",
      "participation": 3.73,
      "movement": 0,
      "previousRank": 159,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 160,
      "store": "NEWTOWN",
      "participation": 3.71,
      "movement": 0,
      "previousRank": 160,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 161,
      "store": "ROCHDALE - SPOTLAND ROAD",
      "participation": 3.7,
      "movement": 1,
      "previousRank": 162,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 162,
      "store": "OLDHAM - ROYTON",
      "participation": 3.7,
      "movement": -1,
      "previousRank": 161,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 163,
      "store": "MARYPORT",
      "participation": 3.67,
      "movement": 0,
      "previousRank": 163,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 164,
      "store": "PERRY BARR",
      "participation": 3.67,
      "movement": 0,
      "previousRank": 164,
      "area": {
        "code": "A028",
        "number": 28,
        "display": "Area 28"
      },
      "areaCode": "A028"
    },
    {
      "rank": 165,
      "store": "FLINT",
      "participation": 3.64,
      "movement": 0,
      "previousRank": 165,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 166,
      "store": "WORKINGTON",
      "participation": 3.58,
      "movement": 1,
      "previousRank": 167,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 167,
      "store": "RHYL",
      "participation": 3.58,
      "movement": -1,
      "previousRank": 166,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 168,
      "store": "LLAY",
      "participation": 3.42,
      "movement": 0,
      "previousRank": 168,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 169,
      "store": "WREXHAM",
      "participation": 3.39,
      "movement": 0,
      "previousRank": 169,
      "area": {
        "code": "A030",
        "number": 30,
        "display": "Area 30"
      },
      "areaCode": "A030"
    },
    {
      "rank": 170,
      "store": "BLABY",
      "participation": 3.38,
      "movement": 0,
      "previousRank": 170,
      "area": {
        "code": "A027",
        "number": 27,
        "display": "Area 27"
      },
      "areaCode": "A027"
    },
    {
      "rank": 171,
      "store": "GUISELEY",
      "participation": 3.34,
      "movement": 0,
      "previousRank": 171,
      "area": {
        "code": "A040",
        "number": 40,
        "display": "Area 40"
      },
      "areaCode": "A040"
    },
    {
      "rank": 172,
      "store": "STOKE - LEEK ROAD",
      "participation": 3.27,
      "movement": 0,
      "previousRank": 172,
      "area": {
        "code": "A031",
        "number": 31,
        "display": "Area 31"
      },
      "areaCode": "A031"
    },
    {
      "rank": 173,
      "store": "LYTHAM ST ANNES",
      "participation": 3.21,
      "movement": 0,
      "previousRank": 173,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 174,
      "store": "KIDDERMINSTER - BIRMINGHAM ROAD",
      "participation": 3.2,
      "movement": 0,
      "previousRank": 174,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 175,
      "store": "CARLISLE - CURROCK ROAD",
      "participation": 3.06,
      "movement": 0,
      "previousRank": 175,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 176,
      "store": "LANCASTER - LAKE ENTERPRISE PARK",
      "participation": 2.73,
      "movement": 0,
      "previousRank": 176,
      "area": {
        "code": "A035",
        "number": 35,
        "display": "Area 35"
      },
      "areaCode": "A035"
    },
    {
      "rank": 177,
      "store": "RAWTENSTALL",
      "participation": 2.48,
      "movement": 0,
      "previousRank": 177,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 178,
      "store": "WOLVERHAMPTON - MARSTON ROAD",
      "participation": 2.46,
      "movement": 0,
      "previousRank": 178,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    },
    {
      "rank": 179,
      "store": "BARNOLDSWICK",
      "participation": 2.42,
      "movement": 0,
      "previousRank": 179,
      "area": {
        "code": "A034",
        "number": 34,
        "display": "Area 34"
      },
      "areaCode": "A034"
    },
    {
      "rank": 180,
      "store": "KINGSWINFORD",
      "participation": 2.36,
      "movement": 0,
      "previousRank": 180,
      "area": {
        "code": "A029",
        "number": 29,
        "display": "Area 29"
      },
      "areaCode": "A029"
    }
  ],
  "previousData": [
    {
      "store": "DOUGLAS - ISLE OF MAN",
      "participation": 17.02,
      "areaCode": null
    },
    {
      "store": "HALIFAX",
      "participation": 10.05,
      "areaCode": null
    },
    {
      "store": "PADIHAM",
      "participation": 9.78,
      "areaCode": null
    },
    {
      "store": "WHITCHURCH",
      "participation": 8.85,
      "areaCode": null
    },
    {
      "store": "CARNFORTH",
      "participation": 8.53,
      "areaCode": null
    },
    {
      "store": "TRAFFORD PARK",
      "participation": 8.13,
      "areaCode": null
    },
    {
      "store": "NORTHWICH",
      "participation": 8.11,
      "areaCode": null
    },
    {
      "store": "DARWEN",
      "participation": 8.07,
      "areaCode": null
    },
    {
      "store": "GLOSSOP",
      "participation": 8.02,
      "areaCode": null
    },
    {
      "store": "WINSFORD",
      "participation": 7.88,
      "areaCode": null
    },
    {
      "store": "WOLVERHAMPTON - DUNSTALL HILL",
      "participation": 7.78,
      "areaCode": null
    },
    {
      "store": "CANNOCK",
      "participation": 7.69,
      "areaCode": null
    },
    {
      "store": "TELFORD - STAFFORD PARK",
      "participation": 7.68,
      "areaCode": null
    },
    {
      "store": "WELSHPOOL",
      "participation": 7.59,
      "areaCode": null
    },
    {
      "store": "WEST BROMWICH",
      "participation": 7.58,
      "areaCode": null
    },
    {
      "store": "MANCHESTER - ANCOATS",
      "participation": 7.53,
      "areaCode": null
    },
    {
      "store": "RUGBY",
      "participation": 7.49,
      "areaCode": null
    },
    {
      "store": "COVENTRY - TILE HILL",
      "participation": 7.45,
      "areaCode": null
    },
    {
      "store": "BRIERLEY HILL",
      "participation": 7.43,
      "areaCode": null
    },
    {
      "store": "COVENTRY - BINLEY",
      "participation": 7.38,
      "areaCode": null
    },
    {
      "store": "DUDLEY",
      "participation": 7.34,
      "areaCode": null
    },
    {
      "store": "BIRKENHEAD",
      "participation": 7.3,
      "areaCode": null
    },
    {
      "store": "MACCLESFIELD",
      "participation": 7.25,
      "areaCode": null
    },
    {
      "store": "HINCKLEY",
      "participation": 7.11,
      "areaCode": null
    },
    {
      "store": "MINWORTH",
      "participation": 6.88,
      "areaCode": null
    },
    {
      "store": "BANGOR - GWYNEDD",
      "participation": 6.79,
      "areaCode": null
    },
    {
      "store": "ERDINGTON",
      "participation": 6.76,
      "areaCode": null
    },
    {
      "store": "ASTON",
      "participation": 6.7,
      "areaCode": null
    },
    {
      "store": "KIDDERMINSTER - EASTER PARK",
      "participation": 6.7,
      "areaCode": null
    },
    {
      "store": "BACUP",
      "participation": 6.69,
      "areaCode": null
    },
    {
      "store": "KNUTSFORD",
      "participation": 6.67,
      "areaCode": null
    },
    {
      "store": "COVENTRY - HENLEY GREEN",
      "participation": 6.62,
      "areaCode": null
    },
    {
      "store": "LICHFIELD",
      "participation": 6.62,
      "areaCode": null
    },
    {
      "store": "WARRINGTON - KERFOOT STREET",
      "participation": 6.56,
      "areaCode": null
    },
    {
      "store": "LIVERPOOL - SANDHILLS",
      "participation": 6.55,
      "areaCode": null
    },
    {
      "store": "NEWCASTLE-UNDER-LYME - CHESTERTON",
      "participation": 6.54,
      "areaCode": null
    },
    {
      "store": "WALKDEN",
      "participation": 6.54,
      "areaCode": null
    },
    {
      "store": "BILSTON",
      "participation": 6.5,
      "areaCode": null
    },
    {
      "store": "BOLTON",
      "participation": 6.5,
      "areaCode": null
    },
    {
      "store": "RADCLIFFE",
      "participation": 6.49,
      "areaCode": null
    },
    {
      "store": "BURNTWOOD",
      "participation": 6.47,
      "areaCode": null
    },
    {
      "store": "WARRINGTON - LATCHFORD",
      "participation": 6.47,
      "areaCode": null
    },
    {
      "store": "ASHBOURNE",
      "participation": 6.39,
      "areaCode": null
    },
    {
      "store": "OLDHAM - HOLLINWOOD",
      "participation": 6.39,
      "areaCode": null
    },
    {
      "store": "CAERNARFON",
      "participation": 6.31,
      "areaCode": null
    },
    {
      "store": "ORMSKIRK",
      "participation": 6.28,
      "areaCode": null
    },
    {
      "store": "HOLMES CHAPEL",
      "participation": 6.24,
      "areaCode": null
    },
    {
      "store": "WEDNESBURY",
      "participation": 6.2,
      "areaCode": null
    },
    {
      "store": "ROCHDALE - MILNROW ROAD",
      "participation": 6.19,
      "areaCode": null
    },
    {
      "store": "LUDLOW",
      "participation": 6.12,
      "areaCode": null
    },
    {
      "store": "HAMSTEAD",
      "participation": 6.08,
      "areaCode": null
    },
    {
      "store": "SELLY OAK",
      "participation": 6.08,
      "areaCode": null
    },
    {
      "store": "KIRKBY",
      "participation": 6.07,
      "areaCode": null
    },
    {
      "store": "HALESOWEN",
      "participation": 6.04,
      "areaCode": null
    },
    {
      "store": "SWINTON - GREATER MANCHESTER",
      "participation": 6.04,
      "areaCode": null
    },
    {
      "store": "BOOTLE",
      "participation": 6.03,
      "areaCode": null
    },
    {
      "store": "COLWYN BAY - MOCHDRE",
      "participation": 5.93,
      "areaCode": null
    },
    {
      "store": "SOLIHULL",
      "participation": 5.86,
      "areaCode": null
    },
    {
      "store": "COLESHILL",
      "participation": 5.85,
      "areaCode": null
    },
    {
      "store": "SMETHWICK",
      "participation": 5.84,
      "areaCode": null
    },
    {
      "store": "LLANGEFNI",
      "participation": 5.83,
      "areaCode": null
    },
    {
      "store": "IRLAM",
      "participation": 5.74,
      "areaCode": null
    },
    {
      "store": "TUNSTALL",
      "participation": 5.71,
      "areaCode": null
    },
    {
      "store": "SPEKE",
      "participation": 5.66,
      "areaCode": null
    },
    {
      "store": "WIDNES",
      "participation": 5.65,
      "areaCode": null
    },
    {
      "store": "ALTRINCHAM",
      "participation": 5.63,
      "areaCode": null
    },
    {
      "store": "NORTH AVERAGE",
      "participation": 5.63,
      "areaCode": null
    },
    {
      "store": "UTTOXETER",
      "participation": 5.62,
      "areaCode": null
    },
    {
      "store": "BRADFORD - THORNTON ROAD IND EST",
      "participation": 5.61,
      "areaCode": null
    },
    {
      "store": "NUNEATON",
      "participation": 5.6,
      "areaCode": null
    },
    {
      "store": "WALSALL WOOD",
      "participation": 5.6,
      "areaCode": null
    },
    {
      "store": "BARROW-IN-FURNESS",
      "participation": 5.57,
      "areaCode": null
    },
    {
      "store": "BAMBER BRIDGE",
      "participation": 5.56,
      "areaCode": null
    },
    {
      "store": "SUTTON COLDFIELD",
      "participation": 5.52,
      "areaCode": null
    },
    {
      "store": "COVENTRY - FOLESHILL",
      "participation": 5.5,
      "areaCode": null
    },
    {
      "store": "KIRKHAM",
      "participation": 5.43,
      "areaCode": null
    },
    {
      "store": "BRADFORD - BOWLING",
      "participation": 5.38,
      "areaCode": null
    },
    {
      "store": "NORTH WEST AVERAGE",
      "participation": 5.38,
      "areaCode": null
    },
    {
      "store": "ST HELENS",
      "participation": 5.35,
      "areaCode": null
    },
    {
      "store": "BINGLEY - CROSSFLATTS",
      "participation": 5.32,
      "areaCode": null
    },
    {
      "store": "AINTREE",
      "participation": 5.29,
      "areaCode": null
    },
    {
      "store": "ACCRINGTON",
      "participation": 5.28,
      "areaCode": null
    },
    {
      "store": "MIDDLETON",
      "participation": 5.28,
      "areaCode": null
    },
    {
      "store": "WALSALL",
      "participation": 5.28,
      "areaCode": null
    },
    {
      "store": "LIVERPOOL - ERSKINE",
      "participation": 5.24,
      "areaCode": null
    },
    {
      "store": "LIVERPOOL - OLD SWAN",
      "participation": 5.24,
      "areaCode": null
    },
    {
      "store": "WOLVERHAMPTON - WILLENHALL",
      "participation": 5.24,
      "areaCode": null
    },
    {
      "store": "BROUGHTON ASTLEY",
      "participation": 5.23,
      "areaCode": null
    },
    {
      "store": "SHREWSBURY - KNIGHTS WAY",
      "participation": 5.2,
      "areaCode": null
    },
    {
      "store": "HINDLEY GREEN",
      "participation": 5.19,
      "areaCode": null
    },
    {
      "store": "STOKE - ETRURIA WAY",
      "participation": 5.18,
      "areaCode": null
    },
    {
      "store": "ROWLEY REGIS",
      "participation": 5.14,
      "areaCode": null
    },
    {
      "store": "RUNCORN",
      "participation": 5.14,
      "areaCode": null
    },
    {
      "store": "KENDAL",
      "participation": 5.12,
      "areaCode": null
    },
    {
      "store": "CLITHEROE - BARROW",
      "participation": 5.1,
      "areaCode": null
    },
    {
      "store": "STAFFORD",
      "participation": 5.09,
      "areaCode": null
    },
    {
      "store": "WIGAN - INCE",
      "participation": 5.09,
      "areaCode": null
    },
    {
      "store": "BLACKPOOL - VICARAGE LANE",
      "participation": 5.08,
      "areaCode": null
    },
    {
      "store": "TYSELEY",
      "participation": 5.08,
      "areaCode": null
    },
    {
      "store": "RUGELEY",
      "participation": 5.07,
      "areaCode": null
    },
    {
      "store": "BLACKPOOL - MOWBRAY DRIVE",
      "participation": 5.06,
      "areaCode": null
    },
    {
      "store": "STOCKPORT - BREDBURY",
      "participation": 5.04,
      "areaCode": null
    },
    {
      "store": "LUTTERWORTH",
      "participation": 5.01,
      "areaCode": null
    },
    {
      "store": "SALFORD",
      "participation": 5.01,
      "areaCode": null
    },
    {
      "store": "WIGAN - SADDLE JUNCTION",
      "participation": 4.98,
      "areaCode": null
    },
    {
      "store": "DEESIDE",
      "participation": 4.97,
      "areaCode": null
    },
    {
      "store": "SHREWSBURY - LONGDEN ROAD",
      "participation": 4.96,
      "areaCode": null
    },
    {
      "store": "LEEK",
      "participation": 4.9,
      "areaCode": null
    },
    {
      "store": "ULVERSTON",
      "participation": 4.84,
      "areaCode": null
    },
    {
      "store": "CREWE",
      "participation": 4.81,
      "areaCode": null
    },
    {
      "store": "STOURBRIDGE",
      "participation": 4.81,
      "areaCode": null
    },
    {
      "store": "TAMWORTH - NINIAN WAY",
      "participation": 4.81,
      "areaCode": null
    },
    {
      "store": "TRENTHAM",
      "participation": 4.79,
      "areaCode": null
    },
    {
      "store": "LANCASTER - WHITE LUND IND EST",
      "participation": 4.78,
      "areaCode": null
    },
    {
      "store": "PENRITH",
      "participation": 4.77,
      "areaCode": null
    },
    {
      "store": "STOCKPORT - HEATON CHAPEL",
      "participation": 4.77,
      "areaCode": null
    },
    {
      "store": "COVENTRY - EDGWICK",
      "participation": 4.76,
      "areaCode": null
    },
    {
      "store": "ELLESMERE PORT",
      "participation": 4.73,
      "areaCode": null
    },
    {
      "store": "CHORLTON",
      "participation": 4.69,
      "areaCode": null
    },
    {
      "store": "BRIDGNORTH",
      "participation": 4.66,
      "areaCode": null
    },
    {
      "store": "CHORLEY",
      "participation": 4.66,
      "areaCode": null
    },
    {
      "store": "KINGS NORTON",
      "participation": 4.65,
      "areaCode": null
    },
    {
      "store": "SKIPTON",
      "participation": 4.64,
      "areaCode": null
    },
    {
      "store": "HAYDOCK",
      "participation": 4.63,
      "areaCode": null
    },
    {
      "store": "HORSFORTH",
      "participation": 4.63,
      "areaCode": null
    },
    {
      "store": "TELFORD - HADLEY TRADE PARK",
      "participation": 4.62,
      "areaCode": null
    },
    {
      "store": "ASHTON-UNDER-LYNE",
      "participation": 4.59,
      "areaCode": null
    },
    {
      "store": "CONGLETON",
      "participation": 4.59,
      "areaCode": null
    },
    {
      "store": "SOUTHPORT",
      "participation": 4.57,
      "areaCode": null
    },
    {
      "store": "BURNLEY",
      "participation": 4.55,
      "areaCode": null
    },
    {
      "store": "NELSON",
      "participation": 4.55,
      "areaCode": null
    },
    {
      "store": "STOCKPORT - HIGHER HILLGATE",
      "participation": 4.55,
      "areaCode": null
    },
    {
      "store": "SHELDON",
      "participation": 4.53,
      "areaCode": null
    },
    {
      "store": "HUYTON",
      "participation": 4.46,
      "areaCode": null
    },
    {
      "store": "LEIGH",
      "participation": 4.42,
      "areaCode": null
    },
    {
      "store": "RUBERY",
      "participation": 4.39,
      "areaCode": null
    },
    {
      "store": "LEYLAND - PEREGRINE PLACE IND EST",
      "participation": 4.37,
      "areaCode": null
    },
    {
      "store": "BLACKBURN",
      "participation": 4.33,
      "areaCode": null
    },
    {
      "store": "MOLD",
      "participation": 4.29,
      "areaCode": null
    },
    {
      "store": "PRESTON",
      "participation": 4.25,
      "areaCode": null
    },
    {
      "store": "TAMWORTH - BONEHILL ROAD",
      "participation": 4.19,
      "areaCode": null
    },
    {
      "store": "NEWPORT - SHROPSHIRE",
      "participation": 4.08,
      "areaCode": null
    },
    {
      "store": "COVENTRY - WILLENHALL",
      "participation": 4.07,
      "areaCode": null
    },
    {
      "store": "CARLISLE - KINGSTOWN",
      "participation": 4.04,
      "areaCode": null
    },
    {
      "store": "DENBIGH",
      "participation": 4.04,
      "areaCode": null
    },
    {
      "store": "KEIGHLEY",
      "participation": 4.04,
      "areaCode": null
    },
    {
      "store": "PUDSEY",
      "participation": 4.04,
      "areaCode": null
    },
    {
      "store": "BURY",
      "participation": 4.03,
      "areaCode": null
    },
    {
      "store": "NANTWICH",
      "participation": 4,
      "areaCode": null
    },
    {
      "store": "CHEADLE - STANLEY GREEN",
      "participation": 3.88,
      "areaCode": null
    },
    {
      "store": "FLEETWOOD",
      "participation": 3.88,
      "areaCode": null
    },
    {
      "store": "STOKE - BURSLEM",
      "participation": 3.86,
      "areaCode": null
    },
    {
      "store": "SHIPLEY",
      "participation": 3.84,
      "areaCode": null
    },
    {
      "store": "WALLASEY - MORETON",
      "participation": 3.82,
      "areaCode": null
    },
    {
      "store": "SHARSTON",
      "participation": 3.81,
      "areaCode": null
    },
    {
      "store": "CHESTER",
      "participation": 3.78,
      "areaCode": null
    },
    {
      "store": "BROMBOROUGH",
      "participation": 3.77,
      "areaCode": null
    },
    {
      "store": "OSWESTRY",
      "participation": 3.77,
      "areaCode": null
    },
    {
      "store": "KINGS HEATH",
      "participation": 3.73,
      "areaCode": null
    },
    {
      "store": "NEWTOWN",
      "participation": 3.71,
      "areaCode": null
    },
    {
      "store": "OLDHAM - ROYTON",
      "participation": 3.7,
      "areaCode": null
    },
    {
      "store": "ROCHDALE - SPOTLAND ROAD",
      "participation": 3.7,
      "areaCode": null
    },
    {
      "store": "MARYPORT",
      "participation": 3.67,
      "areaCode": null
    },
    {
      "store": "PERRY BARR",
      "participation": 3.67,
      "areaCode": null
    },
    {
      "store": "FLINT",
      "participation": 3.64,
      "areaCode": null
    },
    {
      "store": "RHYL",
      "participation": 3.58,
      "areaCode": null
    },
    {
      "store": "WORKINGTON",
      "participation": 3.58,
      "areaCode": null
    },
    {
      "store": "LLAY",
      "participation": 3.42,
      "areaCode": null
    },
    {
      "store": "WREXHAM",
      "participation": 3.39,
      "areaCode": null
    },
    {
      "store": "BLABY",
      "participation": 3.38,
      "areaCode": null
    },
    {
      "store": "GUISELEY",
      "participation": 3.34,
      "areaCode": null
    },
    {
      "store": "STOKE - LEEK ROAD",
      "participation": 3.27,
      "areaCode": null
    },
    {
      "store": "LYTHAM ST ANNES",
      "participation": 3.21,
      "areaCode": null
    },
    {
      "store": "KIDDERMINSTER - BIRMINGHAM ROAD",
      "participation": 3.2,
      "areaCode": null
    },
    {
      "store": "CARLISLE - CURROCK ROAD",
      "participation": 3.06,
      "areaCode": null
    },
    {
      "store": "LANCASTER - LAKE ENTERPRISE PARK",
      "participation": 2.73,
      "areaCode": null
    },
    {
      "store": "RAWTENSTALL",
      "participation": 2.48,
      "areaCode": null
    },
    {
      "store": "WOLVERHAMPTON - MARSTON ROAD",
      "participation": 2.46,
      "areaCode": null
    },
    {
      "store": "BARNOLDSWICK",
      "participation": 2.42,
      "areaCode": null
    },
    {
      "store": "KINGSWINFORD",
      "participation": 2.36,
      "areaCode": null
    }
  ],
  "uploadHistory": [
    {
      "fileName": "Embedded Data (Local)",
      "uploadTime": "9/11/2025, 6:27:25 PM",
      "recordCount": 180,
      "source": "Embedded"
    },
    {
      "fileName": "Day4.csv",
      "uploadTime": "9/12/2025, 10:09:36 AM",
      "recordCount": 180
    }
  ],
  "statistics": {
    "topStore": {
      "store": "DOUGLAS - ISLE OF MAN",
      "participation": 17.02,
      "areaCode": "33",
      "previousRank": 1,
      "area": {
        "code": "UNKNOWN",
        "number": 0,
        "display": "No Area"
      },
      "rank": 1,
      "movement": 0
    },
    "bottomStore": {
      "store": "KINGSWINFORD",
      "participation": 2.36,
      "areaCode": "29",
      "previousRank": 180,
      "area": {
        "code": "UNKNOWN",
        "number": 0,
        "display": "No Area"
      },
      "rank": 180,
      "movement": 0
    },
    "aboveAverageCount": 76,
    "availableAreas": [],
    "biggestMovers": [
      {
        "store": "WALSALL",
        "participation": 5.28,
        "areaCode": "29",
        "previousRank": 84,
        "area": {
          "code": "UNKNOWN",
          "number": 0,
          "display": "No Area"
        },
        "rank": 82,
        "movement": 2
      },
      {
        "store": "WOLVERHAMPTON - WILLENHALL",
        "participation": 5.24,
        "areaCode": "29",
        "previousRank": 87,
        "area": {
          "code": "UNKNOWN",
          "number": 0,
          "display": "No Area"
        },
        "rank": 85,
        "movement": 2
      },
      {
        "store": "LIVERPOOL - ERSKINE",
        "participation": 5.24,
        "areaCode": "33",
        "previousRank": 85,
        "area": {
          "code": "UNKNOWN",
          "number": 0,
          "display": "No Area"
        },
        "rank": 87,
        "movement": -2
      },
      {
        "store": "STOCKPORT - HIGHER HILLGATE",
        "participation": 4.55,
        "areaCode": "32",
        "previousRank": 132,
        "area": {
          "code": "UNKNOWN",
          "number": 0,
          "display": "No Area"
        },
        "rank": 130,
        "movement": 2
      },
      {
        "store": "PUDSEY",
        "participation": 4.04,
        "areaCode": "34",
        "previousRank": 147,
        "area": {
          "code": "UNKNOWN",
          "number": 0,
          "display": "No Area"
        },
        "rank": 145,
        "movement": 2
      }
    ]
  }
};
// ℹ️ TO UPDATE WITH NEW DATA:
        // 1. Replace the entire EMBEDDED_LEAGUE_DATA object above with your new JSON
        // 2. Update the comment with the new date and source file
        // 3. The "📋 Load Embedded Data" button will load this data instantly
    </script>
</body>
</html>
